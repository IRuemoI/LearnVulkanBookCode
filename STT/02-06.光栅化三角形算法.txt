02-06.Vulkan-光栅化三角形算法

好，各位同学大家好，那么这节课呢？
我们来讲解一下光栅化知识里面的三角形算法，这节课呢？
其实比较简单啊，也是比较轻松的一个啊，知识。
啊，我们首先提出一个问题啊，给定三个点ABC，我们如何能够绘制一个三角形呢？
啊，其实就好像是这个啊，图一所示对吧？
三个顶点。
那么，我们接下来呢，就该探求一下啊，对这三个点，我们到底该怎么办？
首先啊，给大家介绍一个方法，叫扫描判断法啊，其实扫描判断法呢，首先我们要做到的是找到它的bounding box啊，就是这个racket就这个立方，这个呃，这个这个矩形。
这个矩形呢？
要找到它的left点啊，其实就是三个点当中x坐标最小的那个点就是a再找到它的right三个点当中x最大的点b。
再找到它的top三个点当中y值最大的点c三个以及它的bottom啊三个点当中y值最小的这个点a。
这样的话呢，我们找到这四个值啊，就能够把这个矩形给圈起来了。
圈起来之后呢，我们要从这个矩形最小的x和最小的y开始啊，在这个点上我们就逐行扫描啊，不以哎，比如说以x步径啊步径扫描这一行扫描这一行一行一行扫上去。
扫描这些点干嘛呢？
我们要看一看这个每一个点啊，是否在三角形的范围内，如果呢，在这个三角形范围内，我们就给它着色，如果不在三角形范围内的话呢，我们就丢弃。
对吧好，我们接下来啊，看一看用向量的知识啊，如何能够确定一个点是否在三角形内，首先是一个p点啊，那这个p点是不是在里面呢？
我们先这么判断。
我们挑选一个a点，从a点啊发射两个向量一个连到c一个连到b。
那么，我们复习一下啊。
我们怎么判断它p点在这两个向量所加成的这样一个扫描空间范围内的，现在我们要这么想象一件事啊，这两个向量是无限延长的。
那么，首先我要判断这个p点在不在它加，在它俩这两个向量所加成的范围之内，对吧？
那么就用AB插成AP。
怎么计算啊？
是不是从伸出右手，从AB握向AP？
我们发现大拇指冲向屏幕外侧。
然后呢，我们再以AP卧向AC，我们发现大拇指冲向外侧，它俩的方向是一样的，唉，那么点p呢，就在三角形的范围啊，就在这两条向量所加成的空间范围内。
但是如果点p在这个位置的话，已经出了三角形了，对吧？
诶，是不是也在这两条向量无限的延长线所加成的这个范围之内啊？
所以说单单纯啊，用这一个a点发射向量是不足的。
我们再以z点发射两条向量。
我们发现a啊cb点叉成CP啊，从cb握向CP，手指头充满了大拇指，冲向屏幕内侧，对吧啊？
记得用右手。
然后CP叉乘CA，它的叉乘结果冲向屏幕内侧啊，所以说呢，可以通过这两种判断啊，加在一起的结果判定p在三角形的范围内。
它既被这两条向量所包含绿色了，又被这两条橙色的向量所包含，那自然而然呢，就落在了这三个边的范围之内啊，那其他的点呢，就被丢弃掉了，这个就是扫描判断法。
那接下来呢，还有软光山中经常用的方法啊，就是三角形分类法，我们把三角形啊分成三种类型，一个是平底三角形啊，有两个点，它的外直小于第三个点。
而且这两个点的位置是相同的，所以被称为平底三角形。
然后是平顶三角形有两个点的y值相同，且均大于第三个点的y值，最后是普通三角形啊，就这样。
我们看一看啊，在平底三角形里面如何把它一行一行的绘制出来啊，首先我们找到啊，在平底三角形当中啊，最大的y值点MM点找到了，然后啊，我们要计算m点与f1之间啊，这样一个方程式。
直线方程f方程one，然后呢m点与f二点之间的直线方程方程two。
然后呢？
我们以m点的y值为起点。
以y=- 1为步长啊，就是你做一个循环，然后呢y的初始值是m的y值，然后呢每一次都减一，每一次都减一啊，直到减到这为止啊，直到减到和f1f2的y值相乘为止。
然后呢，在这个循环当中做什么呢？
要计算啊，每一次啊，计算当y=yi的时候做一条直线，它们呢，这条直线呢，肯定与function 1 function 2有交点p1p2。
所以把这个y啊带到两个方程里面去，就能算出来p一点的x和p二点的x。
然后呢？
我们怎么看以p1为起点？
p2为终点画直线这样一行一行的画下去画下去诶，这个三角形不就画出来了吗？
是这样。
OK，那么平顶三角形如法炮制啊，只不过是平顶三角形的起点呢，是在下面啊，以x移正移为步径啊，往上面走这样。
所以说我们接下来要看一看普通三角形了啊，在普通三角形的研究里面呢，我们发现其实是可以把它拆成两个三角形的，对吧啊？
就比较简单了第一步。
找到y轴方向，最长的边也就是max点和命点啊，确定上下的顶点，然后呢，我们要求啊max与命之间的这样一个直线方程。
直线方程求出来之后呢，轮到没到点出来了，我们以没到点的y值为准，做一条直线啊，那么做直线之后呢，把这个y值带到这个方程里面就能够求出来p点了。
唉，我们就发现啊，这样普通三角形呢，就被分割为了一个上下两个部分啊max p没倒，构成了一个平底三角形p逆没倒，构成了一个平顶三角形。
那么，我们就用平顶和平底的方算法去计算就好了OK？
那么，这个就是三角形常用的算法啊，两个那么在gpu当中呢？
其实比较好用的还是这种算法啊，因为gpu是一个高度并行的，这么一个架构，它里面有很多的计算单元。
嗯，也就是说，对于每一个栅格点来讲啊，我们说的夸张一点啊，说夸张一点的话，你可以想象啊，里面每一个顶每一个栅格点都可以被分配一个计算单元，一次性的通过光栅检测，哎，发现哦，这个在这个三角形内。
啊，可以一次性定型，所以说不需要一行一行，这样去扫描了，而是说把这些光闪点全部输入进去啊，类似于这样的感觉OK，关于三角形，我们就讲到这。

