04-05.Vulkan-交换链基础理论

我们这节课开始来学习交换链，交换链在vulkan的整个图谱当中，它存在在哪儿呢？
哎，在这儿是吧？
slope train啊，它是为了解决多八块渲染以及性的问题。
啊，就是那个屏幕啊，在如果说只有一个八分啊，就会产生撕裂感，这个问题上啊解决这个问题的好，然后swot呢，它最关键的几个点是什么呢？
我们看一看它关心的问题啊。
第一，有很多的设备啊，比如说云渲染的设备，它是不需要交换链，像屏幕进行显示的，再比如说像渲染农场。
它们行啊，用mock en做光锥啊，那么它做离线渲染，它最终输出的是一个影片，而并不是向我们的屏幕进行输出，所以它就不要交换链。
那么所以呢，交换链就被设置成为一种扩展啊，叫做vk sub change extension啊，这样子的形式，那么这个extension它是一个逻辑设备的扩展。
这是我们之前写的vk di mice，它需要在vk di mice创建的时候把这个扩展一起创建出来。
然后呢？
我们看一看交换链的几个细节，所谓的表面知识细节什么意思？
valk an的话呢，它最终啊是要显示到一个桌面上的啊，一个窗口上，那么这个窗口的surface就是它的表面，而surface连接的instance和window。
那么，这样一个表面的话呢？
它支持怎样的细节？
我们把它分为三个类型，第一个是叫做基础特性，所谓基础特性呢？
就是说这个交换链里面因为有很多的图像，比如说呢，它有三个图像轮换显示。
那么，它最小和最大支持图像的数量，最小和最大支持图像的宽高就是它的分辨率就是它的基础特性。
当然，里面还有很多东西，但是我们关心的就是这些。
第二，表面格式啊，什么叫表面格式呢？
死亡池里面是不是有很多的图像轮换显示，那对于每一个图像上来讲，它一个像素的格式是什么样子？
它是2 GB还是2 GBA？
它是r32g32b32还是二八g8b八？
或者是说可能是bgr，所以说呢，一个像素它如何去规定里面的数据到底如何去解释？
就是相合适，然后就是颜色空间这个一会我们会详细讲解。
随后，可用呈现模式，一个交换链当中啊，它有一对图像，那么我渲染完一帧，我把这个图像会送入到显示队列。
然后呢？
我现在开始渲染第二帧，在我的第二个图像上，那么当第二个图像渲染完也会被放到队列当中，假设我们队列里面已经反了，而显示引擎还没有完全啊显示出来，显示完毕。
那么，请问啊，如何去做这样的调度？
我是先进先出对吧？
哪个图像放进去就展示哪个后面的啊？
就等着还是说立即模式？
当前这张图像直接替换掉那一张图像啊，直接进行显示前面的都不要了。
对吧，这就是呈现模式啊，这是一个调度问题，好那么看完这个关心问题之后啊，我们来把表面格式好好研究一下啊，表面格式就是刚才说的这个东西。
那我们好好研究一下。
首先我们看一看颜色空间的概念啊，之前在OpenGL的课程给大家讲过一遍，在这里呢，我们再展开来讲一下。
首先啊，由于各个显示器对于rgb颜色的反应是不同的，当年调的CRT对吧？
显示器那么呃，人们本来以为啊把红色。
从零点五升到一点零，那么它是不是红色的？
这种感觉给人的观感应该变成两倍，亮度会变成两倍啊，但是呢，显示器上它并不是这样的，它呈现的是这样一个曲线。
大家看是下面这一条曲线，它的攀升是非常缓慢的，并不是我们想象中中间这根曲线，而是一个将当前的颜色值把它做一个二点二次幂二点二次方的这么一种展示。
那么，我们看，由于是零到一之间的颜色值，所以说它在二点二次幂之后会怎么样？
会比它现在的值要更小，所以说会变成这样子一个唉，曲线攀升，非线性啊，非直线状态。
那么我们就会发现啊，这与我们的年纪不一样了啊，我们明明把颜色升高为了两倍，我们希望看到的是什么呢？
希望看到的是亮度，也生成生成原来的两倍，对吧？
所以说我们做一次校正，根本的输出的时候啊。
在每个像素输出颜色的时候，对它的颜色进行一次2点2分之一次密的运算。
也就是说，我们原来输出是这么一条直线，对吧？
那么我们现在呢？
把它的颜色，比如说你输的是零点三这样一个红色，那么呢，它就会直接向显示器输出的是零点三的二点二一次，2点2分之一次幂。
啊，二点二一次幂，然后呢？
由于显示器啊，它是会把颜色再进行一个二次幂，所以二者一折中就没有了，那么这两个曲线一个中诶，它就变成了中间这样一个线性的关系。
所以说我们就实现了当颜色值，把它变成两倍，亮度也会变成两倍，这样一个效果。
那么我们看一看在lock当中它是怎么做的这个过程啊？
可以通过lock的图片解读格式和颜色空间翻译格式啊进行好，那么这一点这一点啊，各位同学好好的理解一下这句话的含义，也好好的理解一下这张图。
然后我们啊，理解完毕，你就要往下看啊，没有记得的同学可以暂停在这里看看。
接下来我们讲颜色空间，由于刚才的那个转换的存在，它是广泛的存在，在各个图片软件当中啊pic啊等等啊什么3d max啊。
那么s rdd的空间指的什么呢？
指的是啊，我当前这张图片当中的颜色在存储的时候啊，就已经被做了2点2分之一私密的操作，举个例子。
这个呀，是在PS当中内存里面的那个颜色值，那么当你点击保存为JP AD或者png的时候，它会被转化到从这样几个线性颜色空间转化到s rgb。
那怎么转化的呢？
点击保存，它就会把内存当中的颜色呀，进行一次2点2分之一逆操作运算，唉，然后得到这样一个更加亮的像素。
然后把这个值给保存到图片里了。
他为什么这么干呢？
我们看一下啊。
如果它这么干的话，那么我接下来把这张图片直接打开，然后呢，打开图片的这个程序啊，发现它是s rgb格式就可以直接把这个像素输入到屏幕的显示引擎当中，让屏幕直接显示。
而屏幕啊，由于传统效果的存在啊，传统原因等待会对这样一个像素进行二点二次幂的运算，其实就是把它反到了这样一个真正的颜色上进行了显示。
OK，那么我们再看一下表面格式啊，继续看在文本当中啊，一张图片有两个问题，第一，对于读入一张图片，这张图片到底是什么颜色？
空间的图片如何使用？
我们看到了，由于设计师的存在，设计师呢？
他看到的是什么呢？
他看到的是这个真正在内存当中的颜色吗？
并不是。
他看到的是内存当中的颜色，经过一次伽马校正。
之后得到的在屏幕上显示的颜色。
所以说它在保存的时候就应该做一次二点二亿分之一啊，次幂的操作。
那么，我们读入一张图片，我们读了这个图片，可能就是已经啊，或者说大部分啊，在游戏当中都是已经被做成s rgb空间的图片。
那么，第二个我渲染完一张图片显示器，该如何显示？
如何解释？
对吧？
这张图片OK，我们带着这两个问题去看一下。
对于读入一张图片OK，我们在这详细分析一下呃，我们在wal CON里面啊，读入一张图片，在设计软件，在做一张图片的时候啊，比如PS是吧，其实设计人员看到的是什么，是软件做了伽马矫正后的颜色。
什么意思？
这张图片它本来的像素值是保存在内存当中，假设是零点五。
那么这个零那么设计人人员看到的是什么啊？
他看到的是零点五做2点2分之一次幂运算之后啊，2点2分之一次幂运算之后得到那个值？
送入到屏幕上进行显示，哎，它看到的是这个这个结果。
那么，它呢？
进行存之后，软件啊，会把会保存的零点五吗？
啊，不会保存零点五，它保存的是零点五到2点2分之一次幂这个值。
它一旦按照这种方式去保存的话，我们就称之为什么呢？
s rgb格式啊s rgb格式，其实呢，也就是说伽马矫正后的相似值。
所以这张图片就变成了ssb空间的图片。
啊，这样的图片就是一个非线性的，为什么说是非线性呢？
我们想如果说设计人员呢？
他做了一个啊呃，在内存当中啊，他这个相邻的五个像素啊，是每是每一个像素是原来的是上一个的两倍。
零点一零点二零点四零点八啊，就这四个相邻的像素。
那么，它经过一次刚爆校正之后啊，它们把每一个零点二，零点四，零点呃，零点一，零点二，零点四，零点八啊，这四个值都做2点2分之一次幂的运算。
之后得到的结果，彼此之间还会保持两倍的关系吗？
就没有这个两倍的关系了，对吧？
对啊，所以说呢，它就变成了非线性，是这个意思啊，而存储下来的这张图片里面的颜色。
就不是线性的了，对吧？
就变成了s rcb的非线性空间，那么这样的图片直接打开，正确显示了为什么呢？
因为送入到屏幕上之后呢？
自然而然就被变成了二点二次幂啊。
好，对于wal CON来说，输入的图片如果是s rgb格式，那么你就得告诉wal CON这张图片，它就是s rgb OK，那这个地方呃malkin。
OK啊，输入到open的时候就得告诉open啊，你输入的这张图片是s rgb，那么就得使用vk for matr 8g8b8a8s rgb。
这种格式对其进行，那么我们想一下这张图片被放到显存当中，那么它的数据是什么数据啊？
是不是还是原来那个SSD的数据？
而此时你告诉宝宝这张图片，它就是fr GB，那么接下来我要在这一代当中对其进行使用，那么我采样某一个像素顶的像素。
那么，在采样这个操作的时候，老板就会将其从s rgb转到线性空间，怎么转呢？
它只需要让当前这个像素它的像素值变成二点二四亿就可以了。
诶，那么这张图片上面的所有的像素相关的关系就变成了线性关系，对吧？
这个操作会在au chen采样的时候去做，因为你将才是s rgb。
那接下来我们看显示彪悍恋当中的图片，在这最后会向八块输出每个像素的颜色值，此时啊，如果我们。
让啊stop chat里面的图片是uniform，也就是说线性的这种图片，那么我们现在输出什么颜色啊？
大家就往这个图片上写什么颜色？
这个没啥问题。
那换句话说，如果说我的buffer的图片是s rgb的图片，叫交换链的啊，这几张图片都是s rgb格式，那么在输出的时候fragments hee tr输出一个rgb颜色的时候呢？
就会被过一次2点2分之一逆的运算变成rcs rd的格式再输出到。
那这样做有什么好处？
这样那接下来啊，我拿到了从死亡故事里面输出的一张图片，需要去到显示引擎里面去显示那显示引擎，你知道你这张图片的格式是啥吧？
那么就产生了一个叫做颜色空间的这么一个变量啊，那么对于显示的图片还需要设置其颜色空间什么意思呢？
一般情况下呀，都可以设置成为color spaces rgb。
也就是说，告诉显示引擎，请你以s rgb的形式对我这张图片进行解释，且显示。
那么，显示引擎就知道哦，你输入的是一个s rgb。
那么我就直接把你向屏幕上显示就可以了，为什么呢？
因为屏幕硬件它显示出来的效果就是直接二点二次幂的效果。
直接中和了原来的那个什么这个啊，中和了原来这个2点2分之一次米，所以说显示出来都是对的。
那往往很多同学看到啊，他们在做图形啊，引擎，或者说在自己手上就看到颜色，总是感觉很暗淡啊，或者是说很啊，或者说它的比例很强，为什么呢？
不太真实对吧？
就是因为唉。
因为你把格式设置成为了什么？
这个unit呃是个ii normal呃I normal格式，这个I normal它是行的，但是呢，你又把这个呃显示引擎对其的解释设置成为了这样一个SSD。
你用s rdb的形式去解释这个按钮肯定是不行的啊，所以说你显示出来的三角形就非常的失真，或者是不像真的啊，更加像一动画这种感觉。
OK，那么在接下来的课程当中，我们都可以看到啊，这些的过程。

