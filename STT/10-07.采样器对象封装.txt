10-07.Vulkan-采样器对象封装

同学大家好，我们这节课呢，开始制作粉啊，就是文理的这个采样器对象，在此之前呢，大家回忆一下啊，我们之前讲过说个性异性这个特性需要被我们的3 polar所支持OK，那么我们在这边呢，就要在device里面看一看我们的这个设备到底是否支持？
各向异性啊，否则如果不支持的话呢，你这个就啊太低级了，对吧？
这个意思好，那么我们啊，在这个is这个函数里面，我们加一个条目啊。
这边儿，并且它的features里面啊OK，它的features里面支持an nes。
这个啊s emission trophy啊，就这个这个就是支持各项异性，也就是说我们的设备device必须要支持各项异性才可以传输，才会被进行选择。
然后呢？
我们还得再找到上面啊呃，找到这个feature叫做OK做呃feature看一下。
叫做device feature这里啊诶，是这里啊device feature。
诶device suitable好这里啊，这是create logic device的时候啊，在这个地方我们之前留了个空档对吧？
啊，就是说呢，在它的这里面，我们并没有去开启任何的feature，没有开启任何的特性啊，那这里呢，我们把这个特性打开啊any这个。
等于vk数OK这样的话呢，我们就打开了，各向异性啊好，我们先编一组啊。
看看到底怎么样？
嗯，好。
好，看来没有问题啊，这个设备呢，我们先支持可行性的啊OK，这没问题，如果你不想兼容可行性没关系啊，你那边的话，你可以自己扩展啊，继续到代码可以自己进行扩展啊OK，那么接下来好，我们就开始写三炮的这个对象了，我们也把它封装起来啊。
sampler呢，也是alken的这么一个句柄对象，那么在这边还是添加一个新建文件sampler点h。
啊，封装起来是一个好的习惯啊OK 3号这呢，非常简单，所以它的封装呢，也会做的比较快啊pp好呃，我们仍然是拿一个帽子过来先。
sampler啊，sampler在哪里？
诶，打在这里啊，它就找不到它了，好class sampler。
m小样。
然后public private。
例行公事的啊。
三，polar。
OK，那这里呢？
加个头部啊ptr，把它的增值帧搞进去啊d share。
x3跑了。
static拼盘great。
return呃为。
sampler好，然后呢，我们也把它加到application这边啊，方便编译通过。
sampler好，然后更新一下缓存。
好缩到里面，这样就没有问题了OK，我们看下时间啊好诶，那么我们接下来在这边就写这个三号的文体啊，这个vk。
SEM pooler诶，有这么难是吧？
SEM pooler，然后我也可以now handle。
OK，那么做这样一个东西，一定会需要什么东西啊？
先把这个删掉，一定需要一个device，对吧？
say device。
p点儿，然后m device这个now p点儿好，那么对于我们sampler来讲呢，我们很多东西啊，就把它直接先写死了，所以这边儿啊，我们就直接传一个device算了。
device OK，然后啊，把它拿到这边，把device传进来。
好，我们看一下啊嗯，应该问题不大嗯，好，然后我们就去到sampler的这么一个cpp文件啊，去实现一下这些东西。
是不是感觉三泡其实没多少东西是吧？
三泡其其实也会有它的东西啊，但是呢，我们现在先用不到lipper来。
back up好，咱们构造函数。
哎，构造函数，然后呢，是它的虚构函数。
我们先写一下结果函数，如果sampler不等于vk null handle怎么样？
是不是要把它给干掉？
对吧？
destroy sampler.传入。
然后sampler。
然后是默认分辨器好嘞OK，这个sample这边儿写完了啊，然后说到这边呃，我们现在要做一个采样器啊，做这个采样器的话呢，我们肯定是需要一个vk 3 polar great infer这样一个东西，对吧？
就是个great infer啊，然后great infer。
然后这个create infer，我们让它的sta if=v sample呃vk structure。
type apollo create infer.然后呢，开始设置它的参数啊，第一个参数是mac filter。
那么mac filter什么意思呢？
就是它这张图像啊，如果是变大了，就是说我们拉进去看的话，假设空间中啊，有盖上面贴了张图，你这边很近会变大，对吧？
所以mac filter的话呢？
怎么用vk filter哎？
vk filter叫做啊linear，我们之前还记得啊，这个是设置当它变大的时候，我们用什么样的方式啊？
之前我们先说过有nearest采样方式和linear啊bilinear是吧？
这个东西就是bilinear，就是说我采样了，周边的多少个格子，然后进行平均这么个意思？
啊，我们这两边都有设置就好了，也用这个linear来设置，我们进去看一下啊，你看它还有一个nearer是吧？
还有一个这个东西啊，就近采用法。
根据采样法，就直接采一个啊，这边采n个，然后平均啊，大家这点要记住好，然后infer。
呃，接下来我们要设置address mode uvw啊，为什么有uvw呢？
我们不知道本体坐标是uv对吧？
它采样一个像素w是个啥呢啊？
w其实是在做cube map的时候才用它啊，现在我们不用它。
呃，学过ngl那个系列课程的同学应该是知道这个的含义对吧？
在这里呢，先不做赘述啊，那么这个什么意思呢？
就是说它的超出零到一的这个uv坐标的话，应该怎么办？
我们之前学过，是不是可以repeat可以mirror repeat可以cut border是吧？
可以怎么怎么样？
啊，我们这边的选择是vk sampler，那么address mode repeat啊，我们直接重复就好了，同样这样我们拷出来。
啊uvw好，是不是设置起来非常简单啊？
是吧？
只要你说高分节或者只要你听过我们的理论课程，唉，这个就没什么问题啊，是吧？
然后呢？
我们开启各向异性啊，它的。
any soft你好，你们可以去。
然后呢？
它的呃应该叫做max，那么等于16啊，什么意思呢？
是它的数量啊，采样数量我们知道，如果你用这个的话呢，它肯定要周不少个像素去采样，对吧？
那么，其实加上一个可行性呢？
只不过说它采样的这个区域的形状会发生变化，对吧？
我们也讲过有菱形啊，有什么形啊，什么形啊呃，甚至说比较偏这个梯形啊，都有这种各种各样的采样方式呃，根据你的视角不同，所以说呢，这个采样来讲的话，你到底最多可以采多少个像素呢？
我告诉他说最多你给我采16格的像素啊，对不对？
因为大于16的话，目前的显卡估计支持的还是比较少的啊，那么接下来我们还需要试试它的folder color folder color呃，就是说如果你用不用这个啊，你用click order，那么就是说超出到一的采样部分呢，你要用某一种颜色给它做填充，那么这个东西就是用来设置这个填充色的。
我们生成黑色啊border color，然后叫做into pec black。
这个参数大家如果有兴趣啊，再去研究这个参数，其实没有那么重要啊，然后接下来我们再去写一下它的其他的东西啊，我们看一下这个an normalized coordinates，我们给它v vk force。
什么意思呢？
就是说我们是否使用非呃归一化的uv到w啊坐标体系，但是我们其实是使用的啊零到一对吧零到一？
所以说呢，这边肯定不行啊，我们要关掉啊，关掉好，那么接下来呢，我们再去做这个叫做compare enable，我们是vk force啊，这个compare是什么意思呢？
就是说。
采样得到的样本值需要跟一个值进行比较是吧？
那么比较的方式啊，比较的方式。
也可以设置啊，如果比测试采啊采样，否则不采用是按照这个用处的啊，但是我们这儿其实并不需要做这个，我们只需要给模型贴个图而已啊。
在这里呢，我们写在这里，让大家也是有所认知啊，那么它比较的方式呢，我们直接就是compare always就是你，反正直接通过就好，别通过那么我们看这边也可以，什么呀也可以说比。
永远都通过，可以比它小，可以与它相等，可以小于等于可以比它大，大于等于啊等等，这个意思啊，就这不大于等于这个是不等不相等啊，这个大于等于。
这边也设置完毕了。
那么，接下来呢？
关于啊，这个mip map mip map的话，我们会给大家讲，但是现在不是现在啊，所以说这边是mip map，它的mode我们直接就是vk sample。
mip map mode零点啊，线性的这边先不说啊，我先写在这里。
呃，它的mipload base=0点零。
然后它的mip load呃，不对mip呃min load=0点零，然后它的。
max load=0点零啊，大家这样用上啊，不用担心它到底什么意思啊？
呃，终于设置完这些参数了，我们去生成它a vk great sampler。
m device呃get device第二个参数是它的great infer对吧？
非常简单，拿OP tr默认分配器啊，然后m sampler。
如果它不等于vk success。
那么，我们就flow。
呃SD run camera。
failed to create.sampler好。
然后在这个sample这边呢，我们再补一些接口啊，转到定义补一些接口，比如说。
哎，auto get sensor，把这个get出来的接口。
return m 3 polar。
好OK，然后在这里啊，还有一个bug需要给大家纠正一下，这个很重要啊，各位这边容易导致内存泄露啊，是这回这本函数的时候啊，我们还没有去free image啊，所以我们在这边需要s tbi。
free呃image free。
啊，这个样子，然后这边呢？
我们写啊，把上面这个pixels就是这个这个啊，给它free掉，你看这个原则也很清晰，是不是用API去创建的空间就要用API去给它free掉啊？
这边大家要注意一下啊。
来看一下时间啊OK？
好，那么这节课呢？
我们就先学到这里。

