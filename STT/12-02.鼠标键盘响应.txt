12-02.Vulkan-鼠标键盘响应

OK，各位同学大家好啊，这节课来把这个camera并到咱们的工程里面啊，这个是咱们v工程啊，然后呢camera这个东西啊，我已经把它给拷贝到我们工程里面来了，就放到了这个目录啊。
大家看一下，放到了这个目录，就是跟我们application在一起啊，你把它放进来之后啊，我们的cm ake又会自动的去捕捉到它啊，因为它有这个东西啊，能够自动的去捕捉到它OK。
那么，我接下来怎么去使用这个camera类呢？
那么，我们先规划一下啊，因为毕竟我们这个是做了相应的一些设计。
我们希望最终事件传导出来的时候，就是说你鼠标移动了，或者是说你点了was d这个键啊，那么我希望呢，能够在application里面最终收到这个结果啊OK那么好啊，我就在这里加一个public。
那么，在这里的话呢？
我希望首先啊，关于mouse move这个东西，我能拿到，那么我就是在这写一个on mouse move啊，这个mouse move呢，我希望得到一个double。
然后是x position最新的double，然后y position最新的。
OK，然后呢？
我先我现在啊，除了这个之外啊，我就是说这个鼠标的移动之外，我还希望得到一个什么呢，得到一个这样的一个东西。
啊，就是叫做on mouse呃on key down。
呃，怎么说呢？
on key down代码on key down。
这个呢，就是我们按下了键盘，但具体按到哪个键上了呢啊？
这边呢？
我们首先啊，把它camera拿进来。
然后呢？
这边我们应该传入的是一个camera里面的诶，这没有去生成小缓存。
camera里面呢，有个camera move这个东西啊，我们就要传一个这个进来告诉我到底是往哪边移动啊，就是move。
这样吧，叫move direction。
OK，这是我的这两个啊，这两个函数，那么我怎么才能够通过事件的响应调用这两个函数呢？
那么得去拜托我们的window这个类了，对吧？
我呢，得从window这个类里面啊，存一个application，这个对象的引用啊OK，那么我们怎么办？
首先啊。
我先在这里写一下嗯，在这里吧。
我们用这个东西SD wake。
ptr来给它存储啊，到底为什么用这个ptr不用share ptr呢？
那是因为有一个循环引用的问题啊，我们先把这个class application先做一下声明。
这个具体的写法呢，其实就是防止循环引用啊，这是在这个呃CC加加d rh间的循环引用啊类定义循环引用，为了防止这个就不要去include application了啊，那么我们在这声明一下，然后呢，把这个application勾进来。
map.这个写法什么意思呢？
就是说如果我这儿也是一个share ptr，那么呃，相当于说在application这个类里面有一个window的share的ptr在window里面呢？
又有一个application的share的ptr，它俩互相之间就构成了关于智能指针的循环引用啊，大家要注意啊，这个是解决。
点H文件的循环引用，这智能指针的循环引用w ptr就不会增加它的引用技术啊，这个不会增加application对象的引用技术呃，关于这个C加加11的智能指针，大家可以深度学习一下啊，在这里就不做过多的阐述了。
OK，然后我们在这边看一看，这边要做一个函数了。
set APP那么我们传入的是一个SD share的ptr叫做fa。
开始那么APP。
mapp，我们用这个week ptr来接应一下这个啊，来接应一下这个share ptr，这样的话呢，就会把它的值给到了这个week ptr，它只有一个引用的关系啊，而并没有增加它的引用技术OK。
那么，我们拿到这个APP了，接下来呢？
呃，我们得在APP里面去给它传一下了，但是有一个问题啊，我们看一看。
在in的时候，我们读来了window啊，查一查window在哪里呢？
window okay。
这里啊，我们直接有一个intent window在这里呢，我的window intent完毕之后啊，我想要调它的set APP这个方法，但是我发现诶。
诶，我怎么才能在APP这个类里面啊？
我不能传这次指针吧，对吧？
那并不是我要的智能指针啊，那么我怎么才能在这里面获取到它自己当前这个对象的？
类似这个，当前这个对象的啊，智能指针呢，那我得做一个变化，我在application这边，我必须要继承一个。
呃，标准库的方法叫enable。
able shared from this，那得继承这个方法啊。
application。
OK，那你继承了这个方法之后啊，然后呢，再到这个地方来，你就能够调一个函数shared from this诶，这样的话呢，它就会把你当前这个类的智能指针。
fplayh.诶，对。
我们应该呃，直接就这样调就可以了shared from this。
set APP嗯application shared诶，这样没有错啊。
看一下有什么问题啊OK呃，不存在从这个好，我看一下OK，这应该是一个智能指针转换，应该是一个作用率的问题啊呃，看这个错误，大家可能看不清它说。
不存在从啊fff到ff wrapper application的一个转化啊，那么也就是说，在我们到window里面啊，在这边的话呢，我们不应该这么来声啊，声明这个类了，我们应该换一种方法啊，这样声明这个类。
name base ff这样说明吧。
这样这样也声明出来application就不会受到这个wrapper的影响啊呃，再回到application里面看一下诶，这样就没有问题了好，那么我们现在已经成功的把这家伙传进去了，我们是不是只需要专注在window里面就好了？
我们看一下window生成的过程，之前呢，我们曾经做过一次回调函数啊，就是在这个地方做过了，我们把window这个指针把自己这个window指针作为一个参数传给了glfw的，这样一个window口。
好，那么接下来呢？
我们要开始看一看了，再设置一个呃，再设置一个它的回调函数，应该是说叫做。
glfw set window cursor.window诶，在这吗？
应该不叫这个名字gfw。
set cursor哎cursor position callback cursor就是我们这个哎鼠标的这个小指针的位置啊，那么一旦它动了，它就会去调这个你设置的call back啊，那么它首先传入的就是一个温度。
第二个呢，它会传入一个function啊，这样一个function的话呢，它就是一个专门用来做我们这个回调的function，我们写在这里。
加上一个void呃叫cursor。
这么拼吧c position callback，那它的回到函数是glfw逗，首先是个指针。
然后呢，是double x position double y position。
在这里面的话呢，我们要进行处理，就是我们自己的事了，对吧？
那么在这儿呢呃，我们能够拿到一个。
把这个先设置进去transfer position callback。
因为我们之前已经设定了这样一个东西啊，已经设置了啊，把这指针保温度不像啊，然后我们在这里呢，就能够把它再拿出来，我们这样做。
user data把它转化成window诶，这就没问题了，在window里面呢，我们是能拿到application的，对吧？
所以说我们这个p user data其实已经是那个window了。
at啊，不用get了m。
OK，那么在这边呢，还不太友好啊，我们还要把它给拿出来，把这家伙诶，把我们的这个啊做成一个。
public要学简单啊，刚才呢，因为是private，所以说拿不到。
到这来，mapp OK直接到它的。
OK，在这边，如果我们要调它的函数的时候，你看我们这个cursor呃，我们这个箭头指不出来任何方法，为什么呢？
因为它确实啊，没有引入这个APP的头文件，所以说我们在这可以把这个APP头文件引进来了啊。
然后再开始有同学就问了，说你这里就不会循环引用吗？
啊，不会的啊，我们这边是cpp文件，所以解循环引用解点h循环引用的话呢，你就在啊在点h里面去做这个声明。
然后呢，在点cpp里面，因为你要调用它的函数了，就必须得让它出场了，这样就可以了啊，那是因为cpp和点是分开编译的啊，所以没什么问题。
这块C加加的知识，大家一定要啊，把它牢学习啊好，我这边先。
生成一下缓存。
诶OK诶，这边有点问题OK好，刚才录音软件有点问题啊，抱歉各位同学，那么我们继续来讲啊，这边的话呢，我们现在引用都已经做完了，但是呢，我们发现仍然点不出东西来。
啊，为什么呢？
因为application啊，它是一个wake ptr，它的用法呢？
就不能这么去用了，必须要这样去用啊，给大家写一下关于具体的如何去学习wake ptr呢？
各位要自行进行啊，如果我们先这样子auto。
呃APP=p user，然后呢？
把它的。
APP拿出来，如果APP。
呃点儿诶，然后expired，如果说它不为空框下啊，如果是expired的话呢，就是表示这个智能指针啊v个平台，它是否为空？
如果不为空呢，那么我就这样子APP true呃real=APP点lock。
这样我就能拿到这个ht的真正的智能指针了，然后我再用这个r去调用on mouse move诶，这样就没有啊，传入x condition传入。
y position这样就可以了。
好，那么这个回调函数我们就做完了，接下来呢，我们要去处理一下关于这个k档的问题啊，关于k档的问题的话呢其实。
哎，这个位置上。
okay，关于黑档的问题呢，其实是要在循环当中对卡进行捕捉啊，那么这边的话，我们就得这么做。
我们在豌豆里。
加一个函数啊，加一个什么样的函数呢？
在这边吧。
process呃，叫做想想啊，叫process。
event我们加这么一个函数啊process event，然后呢？
这个process event我先在window点cpp里面啊，我先随便找个地方，先随便写点东西。
这个就是用来处理键盘事件的。
process event.然后我需要每一帧都去调一下这个函数，那么我就要在application里面来做这件事儿application呢，我们有一个main loop在这里啊，我们就在这里去做这件事儿点window。
叫做process。
然后我再回来，在这里呢，我就可以进行查找了，就看一下我们当前到底有没有这个键盘事件，怎么查找呢？
如果glfwgetk。
然后呢m window如果说这个窗口里面有glf。
wka然后叫做w哎，如果是w的话啊，看一下at若等于glfw press，如果被按下了的话，那么我们会怎么样？
那么，如果是这样的话呢，我们就得这么调用了。
把上面的框下来，还是先把啊APP给拿出来？
呃，我们这样做。
如果是空，我们就直接给它。
如果不为空的话，我们就把它给呃看这边。
如果mapp。
为空就是退出，如果它不为空呢，我们就APP=m app lock拿到它的智能指针好，那么这个APP我们就拿到了，如果是press的w，那么我APP的话呢，就得做一个东西啊，就是on kit。
但是这个我们传入一个参数，这个参数呢，我们就给啊，把这个camera先拿进来了。
好好，这个camera来之后呢？
我们就传入它向60前啊，那么就是camera move。
然后叫做move front。
okay，给它。
好，接下来我们一检查，如果是w那么ss就是向后退啊，那应该是。
move back.向后退，如果是按了一个a键，那么应该是move left。
如果是按了一个。
d诶。
它应该是move。
right？
okay，好，然后这样的话呢，我们就就可以实现调用。
呃，application里面的这两个函数了啊，函数我们去找找这两个处理函数在这里啊，然后呢，我们把这两个函数终于可以实现一下了。
那现在在这里吧？
out带上。
好，我们在这里做一些打印，先测试一下。
这边是mouse move。
这边的话呢是？
k到OK，我们现在先做一次清理。
啊，我再生成。
诶，现在有个报错啊bad bad为bad ptr呃，应该是在这里以尼特温度，我们来调试一下啊。
看它是不是在这句崩的set APP，这句崩的。
okay，没问题，选择定义。
诶，这边就有问题了。
原因也很简单，因为我们这个application啊，唉，它并没有是做成一个shared pcr的方式，而是直接声明的，如果你这个类这个对象压根就不是做的这个shared pcr，它也就没办法从类内给你生成了，所以这边我们就改一下。
HD shared ttr.APP.等于scd make share。
application.然后下面呢，我们就把它用这个btr的形式来做就好了OK，我们再试一下。
直接拨好，我们看一下会输出啊，这个是mouse move啊，我们在这里啊，动的话呢，它会输出mouse move，然后我们来点一下上下左右啊。
哎，黑档啊，只能看到黑档了，好那么拿到这样的讯息之后啊，我们就可以往里面去做camera了OK，那么这节课就先到这里。

