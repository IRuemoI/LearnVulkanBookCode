02-08.Vulkan-光栅化视图矩阵推导

我们这节课介绍的是光山化这个流程当中啊，一个非常重要的步骤，叫摄像机矩阵view matrix啊，那么这节课呢，就被应用到前面，我们所讲很多的一些数学知识。
OK那么我们先把问题抛出来啊，如果啊，我给到一个空间当中的三角形，大家可以想是不是这三个顶点都分布在了一个三维坐标系以内，对吧？
就这个世界坐标系。
那每个都有自己的三维坐标，如何呈现到一个二维的屏幕上呢？
这个过程是怎样的呢？
我们这节课只能回答这个问题的前半部分啊，好，我们先把问题具体化。
首先，空间当中有三个点，我们给到一个幕布啊，一个画布，把这三个点向这个画布做投影诶，是不是我们就得到了这三个点，在二维平面的一个坐标表示？
哦，接下来呢？
我们按照啊之前讲过的index 1号连向二号，二号连向三号，三号连向一号诶，是不是就把它画出来了，然后再结合我们之前讲的三角形的绘制方案诶，刷刷刷就绘制出来了啊，就绘制出来了。
OK，那么这个过程里面啊，有一个非常纠结的点就是摄像机的位置和方向啊。
首先，我们介绍一下一个坐标系，叫摄像机作品啊，首先这个是世界坐标系啊，含稳如泰山的落在这里，我们接下来呢，放一个物体。
放完物体之后啊，我们再放一台摄像机，这个摄像机是放在这儿的，如图所示，以摄像机看到的方向的负方向为z轴，那么什么是摄像机看向的方向就是这个，对吧？
它看向这儿。
那我做这个摄像机的坐标系的话呀啊，我会以这个轴为这个方向z轴的负方向，我这样去构建啊，这才是真正的z轴，为什么？
因为之前我们提到过啊，在图形的坐标系统里面啊，我们本系列课程默认的是看向z轴的负方向啊，看向z轴的负方向。
然后呢，我们再把它的x和y构建出来，哎，这个就是它的摄像机坐标系啊，摄像机坐标系好构建这个坐标系有啥用呢？
继续看。
为什么要构建摄像机？
自己的坐标系统呢？
首先回答第一个问题啊，因为啊，最终投影的平面是虚拟的，摄像机的镜头的画布。
那么，摄像机看向何方？
摆到什么位置？
那这块画布就会跟着它去到那个位置上，就好像这样。
你看我们这个摄像机，现在沿着自己的脑袋啊，看向了一个这么一个左前方的位置，看向这儿，然后这块画布呀，都会跟着它跑到这个位置来，而且呢，这块画布永远与它看向的方向垂直。
那这样的话，构建这个坐标系的用处就是这个把物体的坐标系啊，把物体的坐标啊，从世界坐标系变换到摄像机坐标系当中。
那我为什么要把它变进来呢？
是因为啊，我把它用摄像机坐标系的xyz轴啊，来表示这个物体的坐标的时候就可以直接把这个物体的顶点啊。
投影像啊，投影像z轴，投影像z轴，那么比如说这个物体在这啊，在这那么它变到摄像机坐标系当中，投影像摄像机的z轴，那摄像机的z轴是哪啊？
可不是这个轴哈，不是这个方向，是不是与它看向的方向相反诶，是向的屁股后面。
这个那么在空间当中的那个点就可以哎啊，因为它的坐标已经是在这个坐标系里面了嘛，所以说呢，它就直接啊投影向这个这个坐标系的z轴啊，就是这样冲着这个z轴方向投影过来穿透这个幕布诶，这个点打上了，这边还有一个点再投影过去诶，这边又打上了。
是这样一个道理，所以说啊，构建射线坐标系，并且将物体变换进来，是一个非常方便的举动，所以我们给出一个小目标。
我们给到一个世界坐标系当中的点，我们需要推导一个矩阵啊，用这个矩阵去跟这个点的坐标做一次相乘，大家还记得吗？
矩阵乘以一个点的坐标就是把它变换位置，要么缩放，要么旋转，要么平移。
好那么变换完毕之后呢，就可以求出来这个点在摄像机坐标系当中的坐标位置，那我们这个目标就是这样好，我们看一下。
首先我们讲一下啊，从这个图形学当中的相对理论开始看啊，我们给出事列坐标系长，这样我们再给出一个设想，坐标系假设此时我们已经有一个设想坐标系了。
那么，从这个坐标系上，我们能看出什么来啊？
你看这个摄像机坐标系，它的z轴在这儿，那这个摄像机看向哪儿？
是不是冲着这儿？
对吧？
与z轴相反啊。
然后呢？
我们给出来摄像机的位置啊，摄像机坐标系的位置，那么这个原点位置就是摄像机的位置，对吧？
是tx 0 tz也就是说呢，它距离呃，这个这个z轴。
那这个应该是应该是反呃，看一看啊，是这样的啊，距离z轴扯出来这样一个距离，再距离x扯出来这样一个距离啊。
好，然后呢？
我们再拿出一个物体来啊，物体就好像一个点吧，一个点了吧s xs ys z啊，这个坐标点的坐标是世界坐标系当中的坐标，就是这个系当中的坐标。
我们接下来继续看思考一下啊。
物体在摄像机坐标系当中的坐标是什么呢？
我们其实直接就能看出来了，对吧？
因为这个太简单了啊，那不就是说呀，你看这个它的sx是什么哎？
是不是这一段距离呀？
对吧？
这段距离就是它的sx，那么用这个sx-tx是不是是不是不是这个小球距离？
呃，就是说这个小球在这个一个原点的情况下的x坐标啊，对吧？
直接用这块儿x坐标减去这小块儿就拿走了，那么z轴上也是啊z轴上的话呢，这个就是它的z轴的世界坐标。
减去这个tzz小块诶，是不是就是正好是相机坐标系当中的z轴坐标？
啊诶，那么就很有意思，我们看啊g减去的是什么呢？
它减去的是相机坐标系，相对于世界坐标系的位移量，对吧？
我们先不用考虑什么旋不旋转啊，我们看相机坐标系，它在这个世界坐标系当中有一定的位移量。
啊，原来它俩重合，但是我往这移了一下，又往这移了一下是吧？
移出来，然后呢？
对应啊，也就是说把这个小物体的坐标诶减去一下，它们的位移量诶，就拿了它在摄像机坐标系当中的坐标。
好，我们继续看这么思考一下啊，物体在摄像机坐标系的坐标其实就是相对于其原点啊，这是原原来的原啊，比如说这个点的xyz v1啊，就是说它在这个坐标系当中的坐标啊。
其实就是相对于这个点的xyz方向的距离，对吧？
xyz方向的距离，那如果说啊，我把这个点啊，跟这个坐标系。
之间的这个相对距离啊，跟这个原点的相对距离保持不变，就是把这个系跟这个原点混在一起了，你怎么移动它俩都不会说改变相对距离的，那么我们再把当期坐标系直接与世界坐标系重合会怎么样？
也就是说，把它俩捆在一起进行移动，然后把这个象棋坐标系啊诶，把它移过去与世界坐标系重合就是这样。
哦，重合上了诶，这个过程很有意思啊，重合完毕之后会发生什么呢？
我们继续看。
此时，世界坐标系与相机坐标系重合了，而且物体与相机的相对的位置改变是不是没变啊？
因为它们是一起移动的，对不对？
这个小球跟这个原点摄像机的原点。
有变化吗？
没有啊，但是由于两个系重合了啊，两个系重合了，那么物体在世界坐标系的坐标不就是它在摄像机坐标系的坐标了，两个系都重合了，对吧？
你看它比如说啊，它的x轴是多少五？
唉，由于它俩的原点重合了，那它在剩下的坐标系的坐标是不是也是五啊？
唉，这就有意思了，我们看啊，得到一个结论啊，得到一个结论，这个结论是这样，我们是不是只需要找到一个矩阵完成如下目标就可以了，某目标呢一。
我们用这个矩阵把摄像机平移到与世界坐标系的原点重合，然后呢，我们再旋转摄像机与世界坐标系的各个轴重合啊，它的x跟它的x，它的y跟它的y，它的z跟它的z，唉，全部重合上。
这样的话呢，把同样的这个矩阵，哎，大家注意啊，把同样的这个矩阵用在物体上，也进行这样一个变化，这不就求到了它的摄像机坐标系的坐标了吗？
为什么我刚才求绝啊，对摄像机进行了平移和旋转对吧？
唉，那那我此时为了保证这个物体跟摄像机之间的相对位置，还有对角度等没有发生任何的变化，我是不是也得把同样的变换啊？
在这个体上做一遍，才能保证它俩的相对位置不变，对吧？
我一旦做完之后呢？
哦，它两个系统又重合了，对吧？
所以说呢，它的在视觉的系当中的坐标，那也就是摄像机的坐标系当中的坐标了。
啊，这么个道理，这里有一点点的绕，大家可以反复听几遍啊，再用自己的大脑好好的思考一下OK，那么我们的目标已经啊确立了好，那么我们接下来看一看啊，我们要先看一看这个摄像机坐标系的坐标是这个坐标系是怎么构出来这三个轴的？
两个三个植物。
首先啊，我们一定要有已知条件，摄像机的位置，我们肯定是已知的，在程序里面啊嗯，你都是已知的变量啊，然后二摄像机纵向的方向，在程序里面也是已知的啊，这也是已知的质地。
然后呢，摄像机的上方趋势向量唉，什么叫上方趋势向量，你看这个摄像机啊，虽然它是低头看这儿的啊，但它就相当于说什么呢，相当于咱们是你看咱们人站在地上啊，这个yz都成一块地面，咱们人站在这儿，不管你低头看地上也好啊，你抬头看天空啊，只要你没抬的太过分啊。
那么是不是你天空指向天空的这个向量永远是t的样，永远是这个t对吧啊？
这个就是一个趋势，向量就是趋势，向量就是你，你的脑袋上方到底那天天空啊，指向天空的那个向量是谁啊？
一般情况下，这个t啊就会被复制成这个y。
啊，有个趋势向量啊，然后那怎么办呢？
接下来我们来开始构建啊，拿到这个东西之后，我们首先用g与t差乘并归一化得到x轴。
啊g与t差乘怎么怎么办啊？
从g what向t得到它的方向对吧？
就是这个4x。
那构建出来这个cx之后，嗯，在这里我还要提醒大家一下，这个g向量啊，是z轴的负方向，因为是它看向z轴方向的，那么z真正的摄像机坐在z轴冲向哪冲向屁股啊，大家记住冲向屁股。
所以说呀呃，这么一查乘出来，我们得到了它坐标系的x分量，然后我们再干一个事，用cx这个向量与g向量差乘，大家看从cx握向g。
是不是又修出来一个新的向量是cy？
此时，坐标系构建成功了啊。
我们看现在有x有y那z轴在哪儿z轴是这儿嗯z轴不需要补贴，它只需要把g反方向就可以了，来冲向这个d后面对吧，这样的话呢，右手坐标系就形成了，大家把右手拿出来看一看啊。
呃，你的大拇指纵向cx，你的食指纵向y啊cy，然后你的中指呢？
自然而然的就会冲向g的负方向，对吧？
大家可以伸手比划一下，看一看啊。
这样的话呢，我们再观察一下这个坐标系啊g是它的负方向，是负方向是z，然后呢呃，我们用用这个g合理生成的这个cx啊，肯定是与谁垂直。
肯定是与g垂直的嘛，对不对？
因为它垂直于t和g构成平面嘛，所以说它就cx是垂直于了g方向，这个向量也就是cz。
然后呢cx与gx共同构建出来了cy那么cy肯定垂直于cx和gx特性，也就是垂直于了g的负方向。
c对吧？
所以说我们构建出来了一个d卡尔坐标系，几个坐标轴之间互相两点垂直，并且已经规划完毕，单纯的表示了方向。
好构建坐标轴的过程啊！
构建完坐标轴之后呢？
我们要看一看啊！
好，我们就构建开始构建第一个矩阵了啊！
大家明白，要构建第一个矩阵了，第一个矩阵的目标是什么？
构建平移矩阵，将两个坐标系的连点重合过来吧，你哎过来了，用的什么矩阵啊，我就用的是这个对吧？
这个矩阵这个矩阵乘以它的位置就会得到。
这样一个目标原点啊，就会被变到这儿来了。
变转来之后呢，我们就考虑旋转了啊，考虑旋转看一下我们接下来的目标是找到一个矩阵是ro matrix啊，纯粹的旋转matrix使得zx与x轴重合zy与y轴重合。
g的g是什么啊？
g是z的负方向，所以说g要与z轴的负方向重合，我们要这么一个矩阵啊，那么这个矩阵。
目前求法很不傻，怎么去求呢？
你不太知道，但是呢，我们有一个很好的方案，大家还记得逆矩阵吗？
如果我们求不出来当前这个矩阵，我们是不是只需要求其逆就可以了？
而这个逆矩阵求出来再求个逆，不就是它这个没水的字吗？
啊，所以说呢即？
它的逆矩阵是有什么效果呢？
是将世界坐标系的三个轴旋转到与相机的三个轴重合啊，以前我们的目标是什么？
是这样子的目标，但是反过来呢啊，就将世界坐标系的这个一零零与cy cx重合NY啊，零一零与cy重合，所以啊。
啊零零一与g的负方向重合不就行了吗？
你只要把这个矩阵求出来了，再求这个矩阵的逆矩阵，那数学方法就很多了好，那我们看一看啊，给出来直接写出来是这样的，这个就是那个的逆矩阵的样子。
那这个矩阵会发挥什么功效呢？
这个这个矩阵其实是用来啊，将世界坐标系的三根轴啊，一零零零一旋转与这三个轴进行重合的。
我们做个实验啊，测试一下是不是这个效果原向量是一零零，那么我们的目的是什么？
用这个矩阵乘以一零零是不是应该与zx重合呀？
我们算一算对应相乘且相加，那就是cx的x对应相乘且相加，那就是cx的y对应相乘且相加，就是cx z诶，就是cx。
那么，其他两个实验大家自己做一下啊，就用零零一和啊零零一和零零啊之类的，我们去看一看是不是这样的道理啊？
是不是这样的道理？
那么我们得到这样一个矩阵之后，那事情就很舒服了。
我们就可以直接给出结论，若matrix，它的逆矩阵是这样的，transform matrix是这样的，那么我们是不是应该谁左谁右啊？
大家想清楚，没谁左谁右啊，一定是在把这个transform matrix放在右边，它左边乘以一种matrix。
大家注意啊，带负一啊，是逆这边不带负一啊，这边不带负一。
所以说呢，这就是它的用这样一个矩阵，就能够先把摄像机变换到它的原点与世界坐标系重合，然后再扭动它与三个轴方向重合。
那么，这个v matrix啊，就是作用在了咱们的摄像机坐标系上，换句话说呀，如果说你小量级，它的物体与咱们的机啊，保持一个相对位置的不变，就得把这个v matrix同样乘到这个物体的坐标。
那么，当这个我们的v matrix，当我们的摄像机坐标系跟我们的视觉坐标系完全重合的时候，那么那个物体的视觉坐标。
那不就是它的摄像机坐标系的坐标了OK，那么这节课的内容就到这儿了啊，给大家讲清楚了，如何把求取物体变换到摄像机坐标系当中的这么一个矩阵？

