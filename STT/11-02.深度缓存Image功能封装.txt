11-02.Vulkan-深度缓存Image功能封装

一步一步来，把深度缓存这件事啊，加到我们的代码里面。
那么，我们要动手的地方呢？
就肯定是image了，对吧？
我们怎么着也要把这张图片给弄出来呀？
那么弄这张卷的时候呢？
我们就要开始来考虑了啊，这个wal CON里面呢？
应该怎么样去一步一步生成一张debs 8号可以用到的这么一张image？
好，那么我们进行第一样操作，这样操作呢，我们给它的名字取名叫做啊vk format，那么find supported这个rt。
supported format这个函数是用来干啥的呢啊？
我们上节课讲理论的时候呢，讲过说关于深度缓存的这张图片，它所它所要的这种format，它有很多种，有的可能是单独的一种format啊，就比如说这个depth 32格式，那么有的可能是depth 24，然后。
啊，对吧？
那么我们就要确定一种我们现在可以用到的格式啊，就可以用的格式OK，那么我们给到一些选项啊，给到一个函数一些选项，我们说啊肯定有。
它这个数组的格式呢？
里面装的东西呢？
是v format，然后呢？
它叫做end。
好，那就请在这个所有的这种格式里面啊，给我挑一种我们这个目前这种啊device，它所支持的好，那么我们还要给到它，比如说vk image telling。
啊，就是它的ting形式，而且还得符合这个ting是吧？
然后呢？
你还得要符合它的features format features。
flex OK，就这么一种函数啊，那么这个函数呢？
可能很多同学看起来是很懵的啊呃，你看我们以前也做过这种函数是吧？
寻找这种合适的memory type。
然后呢？
我们现在要去寻找一个合适的，这样一个depth的format对吧？
那其实这个函数比较通用啊，它不光是寻找depth format format，它其实还能寻找其他format是否被支持啊？
那么，像这种函数啊，我们先把它一边写一边说啊，像这种函数，它到底为什么存在呢？
因为啊，这个显卡的厂商还有驱动啊，太混乱了啊，各种各样的可能性都有，然后呢，针对不同的平台系统显卡，还有说它的这个呃driver啊，我们都有可能得到不同的结果。
那么telling的情况下啊，你这种telling假设是一种optimal的telling，那么我可能就只能返给你一种什么，只能返给你一个第32的吧啊，其他的我就不能给你用了，这么一种意思啊，兼容性的问题OK，那么这个函数也是比较固定的啊，一边写一边给大家讲，我们首先变一下啊。
for format.那么，在我们的time base里面找一找好，我们抽出来一种format看一看啊，那我们就要去啊，从设备里面拿点信息出来了。
wiki format。
然后properties啊，properties。
呃，那么呃，这边叫做c。
好，然后把这个props给拿出来啊，从那个get出来get physical。
OK啊，get physical叫做device format properties啊，这么一个函数诶，get physical device format。
properties这样一个函数啊，那么我们最后看一下是从这个device里面get出来，那么这个函数它没有啊，这个device的输入那么很多同学就会说啊，它虽然没有给你输入，但是这个image这个地方不是存了device这个东西嘛，对吧？
啊，那么在这个地方的话呢，就要给大家讲清楚一点啊，我们接下来啊，是要在这个image在它这边啊。
我们想加一个public域，在这边我们会做一些呃工具函数，而且它们是静态的，所以说我们先用静态的工具函数创建这个image的时候呢呃，那么它就会需要从外界来传入这样的参数了，这个意思啊，而并不是说通过image对象来调用。
啊，具体为什么要做静态函数呢？
我们一会再看啊，所以说关于这样一个接口，唉，我们就再让它进化一下啊，唉，做一下时间。
接下来，我们将给外资。
好啊，复制过来。
okay，那么在这个地方呢，我们就可以继续写了啊，它是要有一个physical device的，device get physical，physical device。
OK，然后呢？
它第二个是它的格式啊，就是这个格式，在这个格式下，在这个设备里面给我找到它的所有的properties啊，它的相关的一些信息，相关的一些属性都给我拿出来看看，如果说我的telling呢啊，唉。
就是传入的，我们看这个参数就太容易看到了是吧？
太长了啊，给大家做一下这个布局上的优化啊。
OK，我们不是传进来一个telling嘛，我们就希望这张图片啊，是这种telling的好，那么如果这个telling如果是一个vk image telling呃，是个线性的零点的话呢诶，那么我们就得。
看一看啊，这个linder的话，关于这个properties，它是否是支持的啊？
那么在这里呢，就是说所谓的特性啊，所谓的特性是什么呢？
我先把这句话给大家写出来啊，品一品你的props。
它的这个线性linear features啊，这个linear的telling features，那么它必须要能够兼容我们的features啊，我们提出的features。
这个这句话什么意思呢？
就是说啊，如果说你是一种线性的一种呃，它的方式就是你每一行的这种图片，那么那么在你这个线性的这种一行行存储的情况下，那么你的硬件所支持的这个特性必须能够支持我的深度测啊。
或者说其他的特性在这里的话呢，我们在调这个函数的时候啊，这边会传入这么个东西啊，会传入这么一个东西啊，这我在这写吧呃，我们可能会传入这样的这么一个东西啊，这是一种特性，我们读一读vk format格式的特性，什么特性呢？
是说支持了def sensor这种attachment bit。
OK，那么我们看一下它有其它的很多种不同的特性啊，color的特性呃不的特性混合是吧？
顶点的啊，这个vortex buffer beat等等啊，那么也就是说在这种情况下，它要支持我们的这种深度的特性才可以这么个意思啊，当然我们如果用它来判断其它的东西的时候，其它的这个format的时候啊，我们也可以传。
我们其他的这种fs在这呢，就不做赘述了啊OK，那么如果这种情况下，哎，它是没有问题的，它俩呢，这么一与与完之后呢，还能等于这个faces哎，也就是说我提出这个faces它都支持。
那么OK啊，没有问题啊，你这个格式就很好啊，把这个首先找到的这个格式就给你传回去啊，因为首先找到你了，好那么如果。
hailing等于了v ki mage hailing啊，叫做optimal，是一种优化的形式，那么OK同样啊，同样的一个方法pro o ps，它的这个叫optimal的，它的features在羽上，我们的features必须满足我们所有features的要求，我的意思啊。
找到这种之后呢，我们也把这个给搞回去啊，说明哎，如果说两种循环完了啊，所有的格式我都循环完了，我仍然找不到的话，怎么办呢？
没办法啊throw吧scd run。
error cannot find呃proper proper这个format啊。
OK，那么这个就是我们要去啊，确定使用哪一种深度format的这么一个函数啊，那么接下来呢，我们再考虑一件事哈，就是说我们是否有stencil，我们是否有stencil？
也就是说，我们知道啊，这个depth的格式呢？
非vk FM at，比如说我们在这看一看啊vk FM at depth啊第三叉，这种是一种格式是吧？
如果这种格式的话，那就好了啊，那如果说它是一种这个。
d24s2s8的这种格式，那么它对于图片来讲产生一个什么样的影响呢？
就会影响到它的layout啊，影响到一个layout的方式。
布局OK，那么我们在这边就需要再加一个接口了，这个接口能够帮我们判断一下啊呃，到底我们选择出来的这种format，它是属于怎样的一种啊？
format到底是否是有s这种元素？
好OK，那么我们就在这儿写一个量词啊has不玩儿判断一下hass ta ntia l。
for a也没有这样的一个组件啊。
那么，我传入的vv map就行了。
好把这个函数稍微一省心。
帽子摘过来。
在这里我们就很简单的判断一下return。
format，哎。
okay，这个变量是没有吗？
看一下。
OK，我们在这里好像没有存这个image的format好，那在这里呢，我们再补全一下吧，把它format这个很重要的信息给它补上format。
OK，那么这个format应该在什么时候获取呢？
一定是在这个时候获取，在image被建设的时候去获取。
mom,AP.应该等于传入的这个format OK，那么我们这个类就有format元素了哦，好，我们现在回来return m format。
等于啊vk formate 32，然后flow哎，那么s8这是一种带有s的可能性，还有一种呢，是这样子啊format。
等于v这个d24诶，这也是一种可能性对吧？
呃，16的那种呢？
我们几乎就不用了啊，我们现在先选取这两种，将来如果说同学有特殊的需求啊，可以进行特殊的扩展，这样子。
OK，那么我们现在也做完了这方面的一个判断啊，我们这两个工具函数都建立出来了，那么接下来呢，我们就要干一件事了啊，干件什么事情呢，我们就要去到这里。
去实现下刚才所说的那件事啊，在这边我们要做工具函数了，那么这个工具函数的话呢，我们一定是一个的函数啊，我们最终返回的是一个什么呢？
是一张ima get tr对吧？
然后呢？
这个地方的话呢？
我们就啊先写第一个工具函数叫做great。
depth image OK ay k pre depth image啊，那么我们在这里面呢，肯定要调用的是诶，这边还没有去弄上是吧？
这个地方呢？
我们就嗯。
这样吧，我把它声明在这里。
okay，把这头像。
嗯，这样吧，我们把它拿出来。
找到前面来。
好呃，那么我们看一看啊，如果我们有函数的话，一定会去调这个函数，对吧？
在这里面去调这个函数，那么有些东西呢，我们是一定要传进来的。
这个参数是不是一定要传进来呀？
好，这个它是要传进来，我们看还有什么这两个东西要传进来啊。
呃，那么关于format不需要，因为我们肯定是搞深度嘛，对吧？
这个时候创建深度的，所以说不需要传这个了呃，关于t不用传，他们不用传UC不用传啊，采样比克啊，这个我们后面再说啊。
然后呢？
这边是properties使用传啊，关于memory的访问的问题，这个呢？
aspect也不用传了好，那么这个函数就变得非常简单是吧？
就这么一个东西，那么我们去实现一下这个函数。
这样的话，我们在外面用的时候就直接created EX就可以了啊，就非常舒服了诶，我们坐这儿。
在我们这个肋的最上方。
去实现一下这个工程数。
可以在这里呢，我们第一步是要找到相关的格式，对吧？
就是我们到底是这个f到底是什么？
那么我们就要做一个SD vector。
这个来看呢，就是f max，那么它等于。
呃OK k这边等于然后这个vector呢，它是放了vk format好这一年呢，我们就写上我们预先想要去测试的好好多种的，这种带有深度的，比如说第一种是vk format。
呃d32这个啊，纯粹的深度第二个呢，我们想要的是vk format。
32s photo用的八啊，这么一种。
呃，那么我们接下来还需要一个vk format叫做d二四是吧？
然后这个s floats 8 enter。
那么OK，我看一下，应该就没有了啊，我们就规定这几种格式吧，从这三个里面给我抽一个啊，能用的出来，然后呢，我们就去做一个选项啊vk format就是看一下我们这里面到底能选到什么啊，就是最后叫做result format。
等于呃叫做。
okay，我们只要只要把这个调用的函数给它写成静态吧。
这个这边。
有什么震撼的？
这样这个函数啊，就能够在我们一个静态函数里面被调用了啊，可以。
find那么sports map。
第一个传入device，第二个传入是candies，那么就是fast，第三个的话是tally，我们tally呢，就用vk image tallying optimal，因为我们呢，是不需要在CPU当中把它读取的，所以直接用这种optimal的方式，让他们更加的紧凑啊。
然后呢？
我们最后传入它的features啊，用这个可以打Vicky format。
呃，叫做feature。
诶，存量非常大，是depths诶。
week format.feature depths.呃，attachment bit okay，这样就可以上好。
再给稍微的整理一下。
那么，我们就得到了当前的这个格式，写到了格式之后呢，就可以正式的开始创建这张图片了啊，那么我们return叫做image。
create okay，我们一步步来。
首先，device，device。
然后是它的宽度高度，接下来是format，我们就result format。
OK，然后接下来是我们的image type vk image。
type 2d是吧？
然后接下来是它的telling，我们也可以image telling optimal哟，把它拷过来。
呃OK，接下来是它的usage啊，就是我们用于何处呢？
OK，大家看这个地方啊，注意有叫vk image啊usage，它是depth这边一定要有一个stench啊，depth stench。
就没有提示vk image usage depths tanti al attachment date这么一个应用的方式啊，使用方。
那么接下来呢，就是我们的这个采样率啊，采样率的话，我们写个一吧，先写个一啊，然后呢，接下来是properties，它的特性什么是properties来的？
啊，是不是对CPU可见？
对吧？
我们就让它最终可见，反正我们也不会读啊，它以最高效率执行vk memory property。
呃，device local bit好，那么我们再看一下还有什么呢？
还有aspect vk呃，aspect。
depth okay诶，这边有个问题。
啊，这不是一叫vk 3炮。
count 1 down okay，那么这张图片我们就做好了，做好之后呢，我们就可以传出来用这张depth image了。

