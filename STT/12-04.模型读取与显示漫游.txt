12-04.Vulkan-模型读取与显示漫游

各位同学大家好，我们从这节课开始呢，就要去做模型了，然后呢，做了几个工程上的改变呃，给大家讲的清楚一点，首先是这个。
tiny object loader这个的话呢，是一个迷你的一个模型读入的库啊，这个是一个纯图文形式，放在我们的这个课程的主目录下，大家呢可以自己get上下载也可以呢，拿咱们的这个源代码直接进行编译。
第二个呢，在assets里面，咱们加了一个文件夹，是一个car的，这么一个模型啊，这是一个破旧的车，一会咱们要渲染的，然后呢，很关键的一点，在out路径build debug下面的话呢是有一个我们的assets的。
啊，这个size呢？
不管你是debug还是做release，都要拷到这里面来的啊，要把它拷到这来才是真正的运行环境啊OK那么一会儿呢，咱们编写完了，跑测试的话呢，要用release跑，因为debug读入的速度是比较慢的啊，所以咱们一会儿还会产生一个release的目录。
OK，那么咱们现在先进行第一步啊，先把这个家伙给include进来，include一个tiny orbit loader啊，这么个东西，然后呢？
在这上边啊，我们要做一个宏啊，做一个什么样的宏呢？
就是define。
叫做s呃，叫做tiny or bj loader，然后呢，implementation这个红是干嘛用的呢啊？
这个红呢，其实就是用来。
帮助这样一个头文件啊来进行声明的啊，来声明它们实现它们里面函数的一些声明这个意思，然后呢，我们现在对它生成一下缓存。
OK，把它生成了，那么接下来呢，我们要再考虑考虑这个model类，它怎么去做读取动我们之前呀？
做了一个实验对吧？
咱们把addition color uv都给它拆开了，还有index。
那么，我们呢？
持延用这种分八块的做法啊，那么上面这个我tax就没必要了，对吧？
那么我们接下来的任务呢，就是要在model这里面啊，去做一个漏去把model把模型，刚才那模型给load进来。
然后load进来之后在这里面，我们就要给它赋值，对吧？
每一个数组装满我们要的值OK，我们先做void load model。
那我们团队来一个。
字符串就是它的路径。
OK，那么传递这个路径来的话呢？
我们应该接下来怎么去做呢啊？
就应该去读取一下这个关于这个model的东西了，然后读这个model的东西的话呢？
我们要先声明几个变量啊，首先tiny obj就是我们那个库里面的这个命名空间。
它有一个叫做attribute，然后呢，我们给它取名叫啊attribute。
然后呢，第二个变量是那我们需要有一个shifts，我们把它做这个magnetic vector，然后tiny obj。
啊，大家可以不用纠结，它们都代表什么意思，一会我们就能看到了啊。
诶obj。
叫做shift。
shapes然后是vector，any obj。
material这个materials就是它的材质本。
接下来呢，SD string错误的码SD string啊，警告码OK，那么我们现在看一看它是怎么漏的了啊，我们直接调用tiny obj。
的函数叫load obj啊，是一个obj的模型，那么它的第一个参数就是要把诶某些什么变量对吧？
装到了这个attribute里面，然后呢？
又把某些什么变量装到了这个shifts里面。
随后呢，把某些变量装在里面，最后警告信息和错误信息，然后呢，就是它漏掉的这个路径啊，就是pass点儿。
CJ OK，那么如果说它并没有成功，就会返回force，此时我们直接throw就可以了，然后弹个error。
failed to load model.OK，那么接下来的话呢，我们就能看到啊，它这里面到底装的是什么了？
首先我们看一看ships ships的话呢啊，它是有很形状啊，比如说它可能有一扇门，有个轮子，这就叫一个ship。
那么，我们先遍历一下cons to to那么shape shifts。
我们拿出每一个形状来，那每一个形状里面含有什么东西呢？
那么它一定是由一堆的顶点构成的是吧？
然后这些顶点呢？
又由三角形构成，所以说呀，它一定有索引零号，一号，二号构成一个三角形四五六，构成一个三角形六八九构成的三角形等等。
所以我们要把它的index给它拿给它拿出来啊for const alto。
index我们从shift里面，它有一个mesh啊，mesh代表一个又一个的三角形，然后每个mesh或者说一个又一个的三角形的聚合体。
OK shape呃shift mesh mesh下面的是呢，是有indexes啊，我们拿到每一个这个index拿到每一个index之后呢，我们接下来就可以去做赋值了。
啊，就做赋值，那么怎么赋呢？
首先，我们先取出啊，取出顶点位置相关数据。
我们看一下顶点的位置从哪取呢？
它是这样的啊，就是从attribute里面，它里面有一个啊OK，我们看一下attribute里面有一个vertices的数组啊，这里面装的所有的顶点位置信息。
随后呢，我们从这里面输入编号，就能把这一个顶点给取出来了，那么我们取出来的是一个顶点的，比如xyz xyz，这样是排列的啊，它会按照这个index的顺序，比如说零号一号二号，那么就是零号的xyz 1号的xyz，然后xyz这样子。
OK，那么我们看是不是就可以？
是不是可以向呃我们的这个看一下就可以向我们的position里面进行输入了？
OK，我们看一看。
在这边啊。
我们让positions，然后去push back一个数据啊，push back什么数据呢？
是attribute我们可以写了，下面attribute vertices当中的啊，某一个数据首先我取到当前这个index所对应位置的那个点的x值。
怎么取呢？
我们就可以这么取啊？
index用三乘以它，因为我们每三个啊float为一组xiz嘛，然后index is的什么呢？
vertex index。
然后加上零对吧？
这是x。
最后yz啊。
y的话呢，肯定就是它加上1z的话，就是它加上2 OK，这样position的值，我们就都取出来，并且给它取了，然后取出u。
取出uv值。
学位置怎么办呢？
是uv 4这个东西，然后push back用attribute啊，应该该attribute啊，没错attribute它下面还有一个东西叫做啊，它的tax coordinates。
就是它的纹理坐标们啊，这个纹理坐标们呢，肯定是以二为单位，因为一个纹理坐标是由两个flow的构成，乘以什么呢？
还是index，但是这边不一样了，叫做tax coordinate的index。
啊，加上零，这是第一个u对吧？
我们取出来个u，那接下来呢？
还要取出它的v啊，然后v的话呢，肯定就是啊，它降一了。
但是有个问题就是wal CON的话呢，它是以咱们的右上角为零零点，就是这个位置为零零点啊，这样来计算的纹理，所以这张图片呢，从这开始零零，然后零一零二零三零四零五这样子往下走的。
所以说呢，但是我们一般的纹理图片不是这样的啊，我们是以左下角为零零点，然后往上进行生长，所以说它的uv的v就是这个y坐标的，这个值呢，需要用一点零减一下啊，从而得到了它真正的坐标啊，真正的uv坐标。
okay，那么接下来的话呢，就是我们的indices啊，我们看indices怎么做啊？
叫做呃索引。
m index index data s啊，这个东西index data s1开始它是啊零对吧？
所以说呢，我们可以这么干这件事简单啊index data s。
我们可以用它的大写字来做，对吧？
当它为零的时候，这复式进去的就是一个零，然后呢？
它此时就为一对吧？
为一然后再转一圈回来，那么它就把一复式进去了，它就变成了唉index size变成了什么变成了二啊，它是按顺序来的。
这些顶点呢，在这个模型里面啊，也都是按照顺序进行排布的啊index都从零，然后一直到后面的n啊，是这样子OK，那么我们这块呢就构建完毕了啊，这个load model就构建完毕了。
构建完load model之后，我们就要去使用它。
首先呢，我们先把这些呃没用的数据可以删掉了啊，这些colors啊uv啊，什么都删掉啊index都删掉它，然后呢，关于buffer的这几个构建的函数，我们需要把它统一。
剪出来剪完之后呢？
在这个load model这里啊model完毕之后，我们在下面进行构建，我们构建在这个load model函数里面这样子。
然后device的话呢，我们再把这个device传进来吧。
看上边啊，是wrapper device。
OK，那么这个device就可以在这用了啊，好那么no model，我们就干完了，干完之后有个问题啊，你看我们只漏到了它的，因为我们纹理贴图嘛，对吧？
给这个模型做纹理贴图就用不到所谓的颜色了，所以说我们垫儿上就要去里面。
把我text sheet里面这个color呐，给它干掉。
然后呢？
干掉之后我们这个uv值啊，咱们就别动了，就是200啊，就别动了，这个地方因为还得要去改，比较麻烦，然后out color咱们给它干掉啊，就把out color干掉，然后在fragment shed里面，咱们呢这边啊？
也把这个out cari nk给它干掉啊，这些编号咱们都不动了啊，因为这样的话比较简单一点。
最后咱们去到shade里面，到这儿啊，做一下生成。
compile生成OK这样的话呢，我们的这个s per音就生成了OK，接下来咱们第三进入到application里面啊。
我们看原来我们读取纹理的时候是在哪两？
是不是在uniform里面读取的？
对吧？
uniform里面我们有看一下，有一个描述。
在这儿texture的描述来这个描述，咱们是再次dragon ball daytime啊，这种但咱们现在不一样了啊，它的路径是car下面的。
看点d tag，我们看一看是不是这样啊？
assess下面有个car car，下面有个car点JPEG是它的纹理没有问题啊，这样来读进来，随后呢，咱们去到这个model构建的地方。
emittm应该是在这边创建模型啊，这个模型呢，创建完毕之后呢，我们应该去调它的函数model，然后load model，最后我们传入一个路径，这个路径的话呢，就是我们assess。
哈尔卡尔点obj啊，我们手臂电影模型，然后呢，第二个我们把device传进去诶，这样就没问题了好，然后呢，我们接下来去。
去全部清理，然后我们先转到啊，转到这个release，如果我们想要这个release的话啊，我们目前你看只有第二个这个模块对吧，如果我们想要release，我们应该怎么办呢？
在cm所生成的VS工程下面呢，有一个东西叫做c mic setting点儿json啊，大家看叫c mic setting点儿json，我们可以在配置的列表里面加一个摁这个加的按钮。
然后呢？
我们加一个叉六四release选择OK，然后呢？
我们ctrl s保存一下好，这就没问题了，这样的话呢，我们这边就有了叉六四release，我们把release×1下。
okay，然后。
生成生成的话呢诶，肯定是不对的，对吧？
我们看一看有多个定义的符号啊，是t an obj一个问题嗯，好，那么t an obj呢？
这现在有个问题了，就是说呢，我们啊，由于把这个model里面所有的东西都是写在这样一个点h里面。
这样的话呢，会导致它重复生成啊，这样是不行的，所以说呢，我们最好啊，在这个地方添加一个新建文件，我们叫model点cpp好。
然后在model点cpp里面的话呢，我们在这里去生成相关模型啊，首先引用的。
model拿进来，然后我们去到model这里边，把它的namespace拷过来。
好，然后我们把这个old model的这个函数啊，把它丢到这里面啊，丢到这个cpt里面。
这边load model。
我们把model命名空间加上OK，然后呢，我们回头再去把这个地方只改成一个声明。
load model是不是只改成一个声明，然后此时把最重要的这个头文件给它移交到model里面？
好嘞，然后呢？
再去全部清理，然后生成。
这样的话，估计它是打不开的啊。
你看都会闪退啊，闪退说这个呃，各种都是不对的，因为我们东西还没有考进去啊，我们现在才刚刚生成out，刚刚生成build里面的release，大家看在这儿呢啊，所以我们要把资源文件拷进去，一个是assets，对吧？
这个模型啊，贴图啊，都在里面。
一个是shades啊，就这两个东西，我们给它拷进去，进入out build release啊，我们看记在这个地方好把它丢进去。
okay，此时我们再跑一遍。
看这边内存已经开始加载了，对吧？
疯狂的往前跑啊诶，这个疯狂的跑的过程当中出现了问题啊，出现了问题。
我们看一下有什么办法OK，应该是我们在color这个地方啊，因为我们color并没有什么数据嘛，所以说这个地方应该就删掉了啊，我们顺道把color属性也给它删掉吧。
到这边我们把color buffer给它干掉啊，因为一个空的东西，你到这儿去生成一个vertex buffer是不合适的啊，welcome会报错的好，此时全部清理继续生成。
我们看一看到底这个模型啊，能不能给咱们读取出来啊诶？
这不还有问题吗？
哦okay，这边我们把这个呃看看哦，那这样还不行哈，我们还不能简单的呃去把它这么做，我们先这样去干掉它。
干掉它的话呢，这边我们就有问题了，因为在上方的，你看我们这边啊get我tax 8分的话呢，它返回的是两个八分了，而不是三个八分，这样会出现什么问题呢？
应该在于啊，我tax。
input binding description这边的问题啊，先把这些东西的代码先删一删，我们看一看啊，此时我们需要绑定的缓存只有两个了啊，那么这边binding没有问题，这边是一个啊，这边是一个位置。
这边是颜色，需要把它干掉啊，那这儿的单顶就变成了一啊，然后呢，这边也变成了一变成了一变成了一好，没问题这样子。
然后关于描述这边，我们还要改一改啊，我们统一把它改一下。
这边的描述I的描述就是跟share那边挂钩的啊，那我们由于并没有去变动啊，关于uv=2的这个挂钩点的事，那么我们只需要把这个颜色的挂钩给它去掉。
那么uv还是挂钩到二的位置上，这个location为二的位置，但是它的半定就应该是一了，为什么呢？
因为它是从一号内存里面去读的，我们只有两个内存了，对吧？
看一号内存在这儿，二号内存是这个啊，零号内存是这个，一号内存是uv，那么这边自然就是一号内存了。
同样这边是一一一，然后呢？
我们只剩下两个描述，就这样子好OK那么，但是看上去没有什么问题，我们还是要清理生成。
然后去等待这个过程。
好看一下啊，这个疯狂的又开始往上读数据啊，不知道这次会不会有问题？
诶，并没有显示出来啊，没有显示出来原因何在呢？
这个我来看看OK，我感觉应该不是这个问题啊，是我们位置摆错的问题啊。
我看一看关于camera生成的这个位置啊，camera OK，camera的位置在哪呢？
这呢啊，我们一开始的位置让它离远一点呢，我们把它扯到十这个位置上，然后x的地方，我们还让它这样啊，我们还在这，我们看一看。
扯一下位置，会不会发生什么变化啊？
扯到20吧。
20 OK。
集成的加载一下。
诶，看这就问题对吧，然后我们再原漫游一下看看啊，这样漫游的速度真的是好慢啊，把漫游速度调快一点啊，漫游的速度来调快一点，我们调哪来的这儿对不对？
把它变成原来的。
呃，十倍吧呃，50倍哦，50倍直接开始走。
如果各位用debug来读这个模型的话，速度会非常的慢啊，这里给大家提个醒，一定要还是用release的方式去读取比较快一点啊好，然后我们唉，这样就可以比较方便的去漫游了啊，方便的去看到。
这台车子的悬帽就能看到了，来看。
okay，然后我最大化一下。
诶，这呢。
好，那么这节课的内容我们就先讲到这里。
