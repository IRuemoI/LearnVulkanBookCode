02-04.Vulkan-二维坐标变换

好，各位同学大家好，我们这节课呢来讲坐标变换这个呢，就是将咱们之前学到的矩阵跟向量相关的知识啊，做一个整理，看一看在二维图形学当中啊，它到底是如何应用在里面的？
首先呢，我们看一看矩阵与向量的乘法是怎么做的啊？
比如我们有一个三维的向量，哎，是这个一二三那么呢，这个一二三啊，我们要让它与这个矩阵进行相乘，当然相乘是有顺序的，对吧？
这边是一个三×3矩阵，这边是一个三×1的，一个向量啊。
那么，是不是可以把这个向量列成为一个三行一列的矩阵，对吧？
把它理解成为三行一列的矩阵一二三，然后一列，那么这样的话，它符不符合矩阵相乘的规则呀？
是符合的三×3与三×1哎，两个三是一致的，对吧？
它的末尾三跟它的开头三是一致的。
所以我们套用矩阵乘法，那么将当前这个矩阵第一行拿出来，是不是与这个第一列啊进行一个点乘，我们就得到了五对不对？
二×1+0×2+1×3啊得到五。
然后第二行我们再与拿出来与这个第一列相乘，用点乘的形式得到了七第三行与它第一列进行点乘得到了17啊OK，那这样的话，其实呃，我们就可以把向矩阵与向量的相乘理解成为两个矩阵的相乘啊，其实非常简单。
OK，那么。
我们来思考一下啊，把刚才的这个过程啊，我们给它写成一个抽象化的形式，一个matrix在左边乘以了一个p向量，得到了一个p撇向量。
那么，这个过程我们是不是可以这么理解啊？
呃，任何的向量或者是点啊，都可以有自己的三维坐标位置xyz就可以理解成为三维空间当中的一个点的位置啊，那么相当于说呀，这个点等原来待的好好的诶，成立了一个matrix之后变到了另外一个位置上。
对吧，那么得到的新坐标表示的是什么呢？
那么这个乘法代表了什么呢？
那么我们接下来用一个案例来揭开这个这个式子的含义啊。
坐标变换的通俗解释举例，如果有一个点a是个2a平面上的点二二，对吧？
这个a点如果我们给出这么一个式子，我们做了一个矩阵啊，我们看到这个矩阵在它的主对角线上都是零点五，然后在它的辅对角线上都是零。
乘以了二二这样一个向量，或者这样一个坐标位置点，最后得到的是什么呢？
诶，对应相乘且相加，对应相乘且相加，就是一一对吧？
得到了一一诶。
发现是这样的。
哎，所以说我们发现啊，用矩阵是可以进行坐标变换的，这个过程叫做缩放啊，把原来比较大的数字通过乘以一个比例，这个比例是零点五，在它的x和y各自的坐标上统一乘以了零点五倍的缩放。
就缩放到了a这个位置点上啊，那么我们是通过矩阵实现了缩放的话，可否再用这个矩阵实现绕某个点的旋转呢？
比如说我想让这个a点哎，绕着这个坐标原点，让它转一下啊，这样逆时针转一下能不能行？
那么，能否让它进行平移呢？
啊，这样上下左右的平移呢啊，因为我们目前给出的矩阵，只是说按照比例在xy上啊进行缩放啊，或者是说比如说把这个零点五变成五啊，就乘以了五倍，对吧？
旋转的平移怎么办呢？
我们来看一下啊，好研究一下旋转变换啊，当前有一个立方，一个正方形啊，是这样的，然后这个正方形啊，我们发现它是这样啊，逆时针绕着这个原点旋转了45度，变成了这副样子啊。
我们做一个灵魂拷问啊，如何对这个二维的正方形进行矩阵运算，可以让它反转45度呢？
那是不是对每个顶点乘以某个矩阵就可以了呢？
那么我们猜想啊，这个正方形有四个顶点对吧？
唉，这四个顶点是不是这四个顶点的坐标统一啊？
都乘以某一个二×2的矩阵，它就能把它变换成这幅样子嘛？
其实是有的。
我们来推一下啊，这是变换后的样子啊，然后呢，我们假设它的长度为一，当然这你可以假设长度为各种值啊，只是说l=1比较简单运算。
那么，它向啊，这个逆时针方向走了西塔角，然后呢，它得到的坐标是多少啊？
是cosine theta sin theta对吧？
我们看啊，它的横坐标是用这个一乘以这个cosine theta值得到的，对吧？
它的纵坐标是用这个一×sin theta值得到的。
然后我们就可以列一个式子啊newx newy等于那么这样一个矩阵啊，我们用abcd来代替乘以当前，比如说某一个顶点的坐标吧xy。
那么，比如说对于这个顶点来讲，它一开始的xy多少啊？
是不是一零对吧？
在这个位置一零经过反转之后呢？
又得到了一个新的位置，这个位置我们也知道是cos theta sin theta。
好，那么接下来我们看一下啊，用代入法进行解解算啊，比如说我们将原来的一零点，唉，就是这个点原来的坐标啊，代进去再把它最终的坐标cos塞斯塔塞斯塔再代进去，我们可以得到这么个式子。
口径最大就是它当前最新的x值，对吧？
等于什么呢？
我们看一下啊new x是怎么算的？
new x是不是用AB乘以点乘以xy啊？
这样子计算的对应相乘且相加，所以说a×x。
x多少啊？
原来是一对a×1+b×0对吧啊？
这个零点啊b×0得到了a，所以说呢，我们是将这个点的新值和老值啊带进去，我们算出来了第一个a。
然后呢？
我们用x算出来完之后呢？
我们再用y看一看啊，新的y是一个sin theta，那么这个sin theta是怎么算出来的呢？
是不是用这个矩阵的第二行就是CD×xy啊？
对应相乘且相加。
xy是多少呢？
原来是不是还是一零啊？
对吧？
把一零带进去，把s in西塔也带进去，所以塞西塔等于c×1d×0，然后相加得到了c。
同样啊，我们把零一这个点看看，原来的零一是多少啊？
在哪呢？
原来x=0 y=1哦，就是这个点对吧？
这个点没转之前是不在这啊，对不对？
我们看啊，这个点没转之前在这个位置是零一点，转了之后变成什么了，唉，变成了sin cos塞塔啊，变成了负塞塞塔和cos塞塔，对吧？
它的x坐标就变成了负塞塞塔，它的y坐标就变成了cos塞塔。
啊，这样子，我们再把这个点带进去啊，就可以得到BD了啊，这个式子我们没有写，同学们可以自己将这个点的前后变化值带进去看一看啊，好那么这样的话，我们就可以算出来了啊。
将这样一个正方形，或者是说呢，在二维平面啊，任何一个形状吧，绕着这个零零点进行旋转，西塔角度的旋转矩阵就是这样的一套值啊，因为我们刚才算出来了，看啊a=cos西塔是吧这个位置。
c=s in西塔啊，这个位置诶cos西塔s in西塔，然后将刚才另外一组代进去呢，就能算出来了，这个啊b和d好，那么我们现在诶是不是很神奇是吧，我们得到了一个旋转矩阵。
将这个矩阵只要确定了西塔值，然后用这个矩阵呢，乘以空间当中任何一个啊二维坐标平面的点，它都能够实现我们的目标啊，旋转西塔角逆时针。
好，那我们现在研究一下啊，是否可以做平平移的变换呢？
这平移就简单多了是吧？
你看将这个正方形唉，往这个上面平移一下x方向平移txy方向平移ty啊，你也可以是负的，对吧？
也可以是正的。
那么，新的坐标位置呢？
它等于x+txy撇，等于y+ty，对吧？
这很简单啊，接下来我们考虑一下一个重要的点。
灵魂拷问如果写成向量计算的形式，唉，是不是就是这样一个公式啊？
对吧？
x撇y撇y=xy+TXT y啊，就这样一个形式，但是我们发现啊，我们的目标是什么？
那么，我们的目标是希望有一个矩阵，这个用这个矩阵乘以这个xy能算出这个x撇y撇，而不是说从这里单纯的加了这么一个TXT y的，这么一个向量啊。
所以说我们，但是我们却没办法把它写成一个矩阵与向量相乘的形式。
这就很头痛啊，但是啊，我们是有这个诉求的，我们希望啊，不管你旋转也好呃，缩放也好，还有我们现在研究的平移，都希望能是一站式的解决方案，那它说所以说我们仍然要找到一种方案啊，就能够让它全部把这三种变换都写成乘法的形式。
啊，那么我们怎么办呢？
我们的啊，前辈们研究出来了一个很牛的东西啊，叫做其次坐标变换。
我们来一次一次的看一下啊，首先看一下，其次坐标是什么？
是为了迎合平移变换且能相乘的形式啊，就是我们刚才的目标啊，我们为每一个顶点或向量呢坐标加了一个维度。
让二维向量升为了三维向量啊，这个可能对于刚接触的同学来说不太好理解啊，但是我们一点点的看，如果你是一个点。
我们都知道啊，点是不是也是xyz，然后向量也是xyz对吧？
你如何去分别这个点这个坐标值是个点还是个向量呢？
在其次坐标里面，我们做如下规定。
如果它是一个point，我们就让它，比如说在二维啊s xy诶，我们给它加一个欧米伽，让它的欧米伽等于一，所以说把二维向量就升为了三维向量。
这个小t代表因为我们一般都是表示成这个列向量嘛，对吧？
它表示成列，所以说横着写，简单加个t啊，意思就是它是个列向量的意思啊，所以说这个point就变成这样，那对于一个vector来讲，我们让它等于xy让它的欧米伽等于了零。
为什么这么干啊？
我们一会就明白了，看一下。
如果它是一个point，一个位置上的点啊，那么我们为了计算新的这一组，其次坐标是x撇y撇欧米伽撇，那么我们诶可以创造这么一个三×3的矩阵。
那么，这边是一个三乘幺的向量，对吧？
我们看它俩相乘得到的是什么？
第一行对应相乘且相加啊，一零t xxy 1是不是就得到了一×x的x0×y的0 tx直接加到上面去了，对吧？
那第二行是不是也是一样的呀？
第二行是x这个位置为零，所以x没了y+ty了，然后呢？
第三行是零零幺，前两个都没有了，一×1得一。
唉，很有意思吧，我们算出来了啊，我们最终算出来的结果是新的坐标位置值，唉，刚刚好通过乘以这样一个矩阵，且把我们的位置给变成其次坐标，唉，还真的能够通过矩阵相乘的形式把它。
得到最终的结果xy值平移之后的结果，我们拿到了，我们再看一看啊，如果是向量的话会怎么样啊？
向量的话呢？
我们知道啊，如果是向量，它都米达为零对吧？
所以说我们经过了这样一个平移变换，我们发现啊。
一零tx比如说算x撇啊，一零tx与它对应相乘且相加，发现哦，这是个x没变，零一ty与xy 0对应相乘且相加y也没变，最终呢，零零幺与它对应相乘且相加。
哎，发现这个地方啊，这个地方应该是零啊，这个地方应该是零，然后再改一下啊。
这个地方呢，应该是0 okay。
那么我们发现啊，如果是个向量来讲的话，它经过了平移变换，它没变化哦，这个很有意思了，对不对？
我们之前讲过，说向量是没有什么位置的，对吧？
它只是表示一个方向，所以说呢，我们这样去规划，其次坐标是正确的，如果它是个点的坐标，坐标表示它就刚好可以。
变换成我们平移之后的样子，如果是个向量，你怎么平移它都没用，因为我只表示方向好，这个其呃其次坐标的表示方案是我觉得认为它是一个非常非常伟大的发明啊，直接解决了我们。
不能够把平移进行用相乘的形式进行表达的这么个问题啊。
好嘞，那么我们现在就可以给出矩阵变换的二维全家福了啊，缩放矩阵xy还有一啊，这边是这样的长相旋转矩阵是这样的长相啊，都把它变成了其次坐标的矩阵啊，因为我们嗯，此时的点或者是向量都加了个欧米伽嘛，对吧，变成了三乘幺的向量了。
那么，现在矩阵也变成三×3的矩阵了，对吧？
我们看啊，每一个的前四个这个数字是不是就是我们刚才推导出来的样子啊？
这两个只不过把它扩展成了一个三×3的矩阵而已啊。
这边呢，就是平移矩阵好，那么我们研究一个问题啊，我们现在知道了呃，缩放旋转和平移的矩阵那么问题如下如图所示的变换有没有矩阵相乘的顺序问题呢？
如果有平移跟旋转谁先谁后的问题。
我们的目标啊，看这边有一个立正方形，这个正方形的中点啊，刚好就位于这个坐标系的原点，我们现在的目标是什么呢？
希望把它变换成这副样子啊，这是个什么样子，大家看一下啊。
它的原点啊，是不是由这个呃，这个立正方形的中心点由原点变到了这个位置啊TXT y这个位置，然后呢且啊，这个正方形还绕着自己这个原点还转了个c3角。
哎，我们怎么办呢？
我们看一看啊。
如果先旋转再平移会怎么样？
大家可以认为这个过程是成矩阵的顺序啊，成矩阵的顺序，如果说我现在给这个正方形的每一个坐标啊，这四个顶点的每每一个顶点坐标都去先做一次旋转再做平移会发生什么？
乘以旋转矩阵诶，转了个斜三角，再给它平移每一个顶点来进行平移，对吧？
诶，平移出去。
这是一种变换方式，对吧？
那么我们刚才想要得到的呢？
就是这样的方式，对吧？
唉，就是这样的方式好，那么我们再看一看，先平移再旋转会怎么样啊？
平移走旋转走诶完全不一样，对吧？
为什么呢啊？
为什么呢？
因为啊，我们这个旋转变换呢？
是基于原点，绕着原点去转的啊，绕着原点去转的，所以说我们在诶，所以说我们在。
仔细的看一看刚才的这个过程啊，仔细的看一看刚才的过程。
这样子啊，仔细看一看刚才的过程呃，由于第一个先做了旋转，所以说它的旋转轴是谁啊？
是不是这个点对吧？
转哎，转了转完之后再平移就没有什么参考了，对吧？
直接平移。
但是对于它来说呀，它是先平移了，但是呢，它还是绕着绕着这个原点进行旋转啊，大家看这是原点，所以点一下之后呃，它就绕着这个点旋转了，所以说我们最终得到了一个东西啊，就是。
变换矩阵之间的相乘是有顺序的，是从右往左依次对顶点进行加工的啊，所以说之前我们讲矩阵的时候说呀AB跟BA这两个AB矩阵对吧？
这样一个相乘，我把它换想成b×a了是不是一样的结果呢？
其实不一定对吧？
不一定就在这。
所以说啊，你看我们如果有这么多的变换矩阵啊，假设a1是缩放，然后平移再旋转，再平移再缩放再旋转等等啊，这么一堆变换累加在一起，最终构成了新的坐标位置点，那么这些东西都是有顺序的，所以说呢，我们在做游戏的时候一定要考虑清楚啊。
是先让它平移，还是旋转先让它旋转啊？
或者说先让它怎么着再怎么着啊？
所以说呢，矩阵变换是有顺序的，那么它的乘法顺序是这样的，对于这样一个原始坐标点，会先由a1进行加工。
a1加工完之后啊，得到的那个新的点，再由a2矩阵进行加工，最终呢，一路加工到an矩阵就这样。
好，那么关于啊，坐标变换在二维上的表达就讲到这里。

