10-09.Vulkan-Texture描述符系统加入

各位同学大家好，我们上节课呢，已经做好text这个类，并且啊，我们在application里面已经把这个实验性质的东西给它生成了，那么这节课呢，我们要把text与我们的descriptor给绑定起来，把它作为一个uniform，我们需要往里传了啊。
那么现在呢？
我们就把这个实验性的代码呀，是可以拿掉了啊，这个是为了验证我们的text生成没有问题的啊，然后在这边同样啊，对一对一，我们要拿掉它。
好，那么我们是不是要在这个里面动手脚了？
是不是在这去生成？
因为它是属于uniform的这一部分啊，那么在这边的话呢，我们看一下innate是不是对于每一个uniform来说，我们要生成这么一个描述信息，然后哎，把它传到里面去生成layout呀，来生成这个poor啊，来生成de script set呀，对吧？
这样子。
那么，这个描述信息里面呢？
现在是没有哎，是没有图片相关的啊，没有拍照相关的，那么我们在这儿需要把它做进来。
当然，这个写法是比较丑的啊，因为我们需要退出来，去到texture里面再拿texture点h啊，这样的话呢相当于什么？
相当于wrapper里面的东西就引用了这个外面的啊，但是为了教学的方便啊，然后为了大家理解比较简单，就不去做很复杂的架构了，我们先这么去用啊。
先用的舒坦再说，那么在后面呢？
我们在呃，可能在其他的课程里面，我们就知道教大家怎么写work引擎OK，那么texture。
点儿啊。
好，那么我们去到uniform的这个unit里面，我们看一下半定点就用掉了零呃一是不是我们接下来要半定点要用到几了？
是不是要用到下面的这个二号半定点对吧？
在这里我们写哦texture error=wrapper。
uniform，但是没反馈。
来，然后我们来填写下它的信息，首先band点等于二号，然后呢，它的count我们也写成一。
然后呢，是descriptor type，我们是vk descriptor，然后type combined image 3就是image和sampler合在一起的，这么个东西什么东西呢？
就是我们那个get。
然后m呃size我们就不需要填写了啊。
需要填写了，那么这边的size应该是不需要我们填写的，因为我们不需要去生成这个东西啊，不用记录它的这个大小是吧？
OK，我们看一下还需要什么要填的吗？
嗯。
然后是binding 8，不需要填对吧？
com填完了type填完了c填完了诶stage把stage需要填一下，那么stage=vk。
我们看一下上面怎么填的啊？
那么叫shader stage vertex bit，那么我们叫这个应该叫做shader啊stage fragment beat，我们是在fragments去做采样的。
OK，那么这个信息呢？
还缺一个东西啊，就是说它的生成啊，这边的话需要做这个问题，那么它的mtector应该等于啊，等于什么呢？
等于tector。
create这边需要一个device，你这有没有device啊？
看一看哦，这边有啊，有传过来device好device，那么这个device呢？
我们看一看要不要在这个类里面把它记录下来会比较好一点啊？
OK嗯，好，我们把它记录下来吧，因为device毕竟是依赖关系，跟所有的这个locker都是依赖啊device。
apple device.对好。
诶，这边应该是right？
那emit的时候，我们把这个。
先记下来，不管有没有用是吧？
还是一个好习惯，然后这边等于m device。
第二个参数是command破啊okay，那我们需要一个command破了，看一下有没有进来呢？
嗯，好好像貌似没有传进command破是吧？
嗯，好，我们把command pro也拿进来。
这边，然后去到innate这边。
好把我们的pro拿进来，然后。
再回去把它添加进来。
嗯，好command pro没有了啊，在这边我们就把command pro进进来，毕竟用一次嘛，就不需要记录了，然后是它的路径。
哎，这边有个e。
路径的话呢，我们是在access里面的。
加电炮。
dragon ball点cp ad好，我们看一下这个text也生成了是吧？
然后呢？
我们把它放到uniform parents里面。
actor.carry okay，那么接下来呢？
我们先看layout这边有没有需要处理的地方啊？
转到定义。
看一下啊。
嗯，那么layout呢？
主要是记录了，这是count binding type。
OK，看来这边啊，应该是没有需要处理的，然后呢，再去到里面需不需要处理呢？
好，这边有个to do啊，需要处理，我们看一下，如果。
param它的m discrete time，如果等于等于k于kis to vector type combined image sampler是吧？
我们是不是需要做一个计数啊？
就在这边要记一下数。
啊，有多少个这个呃te cher te cher count？
零然后我们让text count加加。
好，那么下面就不需要了啊，接下来呢，我们去到看一下再来。
创建set的时候。
在这边啊。
这边的话呢，我们写入描述信息是吧？
这边有个嘟嘟看到没？
这个地方是什么？
是在啊，往这个descriptor set里面写信息的时候，这么一个过程啊，那这边应该是什么呢？
我们看一下descriptor right？
它的啊p buffer infer肯定不需要喽啊，因为我们毕竟不是一个buffer infer是吧，我们是一个呃什么呢，我们是一个p。
image infer啊，这么个东西OK，那么我们一看啊，以前在做buffer的时候呢，我们这边是返回的啊，这个东西是一个引用，对吧？
同样啊，在text的时候，我们这边也要返回一个引用，否则呢，它就啊没有了是吧？
那我discard了。
auto get image infer啊。
那么，这个不能是auto了，这边应该是一个这个这个类型的引用const return叫做an image infer好。
找一下为什么啊？
image in flow。
哦，这边不应该是const啊，去掉。
好，那么我们再回到这个地方啊，再回到这个地方看一下in这个地方，这个地方我们就可以用param的一个引用啊get用它的m啊叫actor。
然后呢，去做到get image infer，把它给绑上去诶，可以了啊，这就可以了。
好，我们再检查一遍啊，就不需要别的东西了。
那么，descriptor set这样，我们就创建完毕了啊，创建完毕了，我们再回到这个shader里面啊shader里面的fragment这边，我们也要加个东西。
这边怎么加呢？
我们需要加一个啊，叫做layout，然底等于二的这个部分是一个什么呢？
它是一个uniform。
然后这个是一个SEM p lar 2 d lar 2d，这么一个东西，然后呢，叫做get ersemplar啊OK，把它放进来啊，然后我们去。
打开文件夹，那么做一下编译。
好，然后啊，生成的这两个东西呢，拿去到out build这个，然后去到这个去到。
我时间段提起来。
好，肯定不要急了。
然后呢？
我们现在回来运行一下啊，看一下先清理一下。
生成还不错。
诶OK好，咱们加两个参数是吧？
这边调用的时候啊，我们看一下command buffer已经生成了吗？
e script or然后command啊？
是在这边做的啊？
那我们把这两个东西再。
想一想。
啊，可以，我们把它拿下来，拿到这个pro生成这个command，生成之后我们拿到这儿来。
啊，把这个去掉。
然后这边是m command破。
然后创建模型等等在上面啊，好，我们再运行一下。
哎，出现问题了，看一下什么问题呢啊，这边啊，这边不对了啊，这类要的不对了。
好雷奥特部队的话，那我们看一看怎么做调整啊？
嗯，雷奥特部队的原因也非常简单啊，因为我们去到这个嗯，在这里application这边的时候啊看一下。
嗯，在做back line的时候呢，需要一个layout的信息啊quick line，需要一个layout的信息，结果我们layout其实是在这边生成的是吧，在这边生成的。
啊，那么我们把它拿上来吧，还是去到呃model还是把它放在这儿呗，对吧？
然后只不过说这个pro的创建需要填一下了啊。
放在这吧，这样就可以了，我们看一下。
好呃，这个照常出来说呃，这边有问题，它说什么呢？
呃unable to allocate三个is process of type呃from。
OK啊，是这个意思啊嗯，我们看一看de script port创建的时候有没有问题啊？
de script port创建的时候嗯OK。
呃，放。
在这边在这边呢，我们并没有去啊，做这个关于texture相关的这个size啊，叫texture size。
我们得在这补上这个东西啊，这个东西的type大家学到这里，是不是觉得老肯真的是惊天地泣鬼神啊？
对吧？
但是只要你封装的好就可以了。
type叫做combined，应该是simple这个东西。
然后呢，它的descriptor count我们有多少个呢？
我们是有呃texture count个，但这边呢，我们是不需要乘以frame count的啊，这边需要注意了不？
不需要每一根一个，因为全局只读啊，对吧？
你只会读取这张图片，不会去更改它，所以我保一个就足够了，大家共用这一个啊。
然后pre sizes还有back那么texture size。
好，那么还有一个问题啊，就是在descriptor set这个地方啊，这边的话，我们是不是哎？
你看frame count个这样在循环啊，对吧啊？
在循环，所以这边呢？
嗯，我们就不能这么简单的这样去做了啊。
我们看一下get image okay嗯啊，这是没有问题的啊，给大家讲一下，这是没有问题的，因为我刚才在想啊，这边是不是说会搞出来三个呢？
它是更不会啊，我们每次去给这三帧啊，就比如说我们有三帧啊，那么我们给每一个scripter set里面在写入的时候呢？
我们的这个buffer啊，每一帧一个的对吧？
但是我们这儿呢是所有帧共用的啊，而且是共用的，它的已经被生成的信息，一张图片三个帧都在用它啊，这个意思好，我们来跑一下。
诶，又来了一个问题，我们读一读啊allocate三零八two allocate三个disc of jerk combine image from for this probably only has one this啊，okay？
嗯，好，明白了啊，这是刚才的问题啊，刚才这边儿这边儿有一个讲错的地方，大家一定要注意啊，这边儿老师写错了啊，给大家用错了，不是这样的啊，这边儿的话呢，毕竟它说的是。
这边大家要注意啊，这是一个理解性的问题啊，应该乘一个frame count，为什么呢？
因为这点size是指啊，有多少个descriptor啊，多少个描述符？
有多少个描述符呢？
就得就得给它多少个这种size那么size的含义，大家再复习一下啊size是指那么当前我要去分配的这些d。
那么，总共在一起啊，比如说我们有三帧，那么我们就给每一帧每一个object，每一帧每一个object，对吧？
都要分配一个呃，这个descriptor set。
那每个里面有frame buffer跟texture对吧？
那这样的话呢，这边儿我们就需要让它乘以乘以一个frame count啊，那因为它并不是一个呃texture的概念，而是说texture描述符descriptor描述符集的概念啊。
OK，所以这边要乘以这个东西好，我们再跑一下，看还有什么管理提示内容能够提示我们东西啊。
哎，现在没有任何提示了，对吧？
关掉有问题好，那么在这边的话呢，就给大家做一个总结啊呃w这个系统啊，真的是异常的麻烦，其实现在我们所写的整套啊，是用于教学用的一个。
比较分块的架构，那么真正我们用的时候呢，其实啊，还是要去把它写成引擎的形态的啊，那在这边的话，我们尤其要区分开这个descriptor pro里面的这个size的概念。
以及de script layout的概念，我们还要区分好descriptor set的概念，这一堆概念总体上也要与我们的buffer和texture别区分啊。
text全局只有一张一个image，一个sampler，但是呢，它的描述信息我们把它哎，需要生成每一帧的。
且每一个object，每一帧一个好，大家听，仔细听，每一个object，每一帧一个。
好，那么这样的话呢，就要在size上来动手脚了，对不对？
因为我们要告诉系统，我们统共有多少个描述符？
那么这边就是多少个猜词的描述符OK，大家仔细去理一下，也要及时的复习好，我们就讲到这里。

