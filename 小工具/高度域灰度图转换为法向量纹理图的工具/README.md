# 高度域灰度图转换为法向量纹理图工具

这是一个将高度域灰度图转换为法向量纹理图的Python工具，使用PySide6构建图形界面。

## 功能特性

- 🖼️ 支持多种图片格式（PNG、JPG、JPEG、BMP、TIFF）
- 🎨 直观的图形界面，左右对比显示源图和结果
- 🔧 基于向量计算的精确法向量生成算法
- 💾 自动保存生成的法向量图到指定目录
- 📝 完整的函数级注释和文档

## 安装依赖

```bash
pip install -r requirements.txt
```

## 使用方法

1. 运行程序：
```bash
python normal_map_util.py
```

2. 点击"选择源图片"按钮，选择要转换的高度图
3. 点击"生成法向量图"按钮，开始转换
4. 点击"保存结果"按钮，保存生成的法向量图

## 算法原理

该工具使用以下算法将高度图转换为法向量图：

1. **灰度转换**：将输入图像转换为灰度图
2. **梯度计算**：使用相邻像素计算高度梯度
3. **向量计算**：
   - 计算两个切向量：上方向和右方向
   - 使用叉积计算法向量
   - 对法向量进行归一化
4. **颜色映射**：将法向量的X、Y、Z分量映射到RGB颜色空间

## 文件结构

```
高度域灰度图转换为法向量纹理图的工具/
├── normal_map_util.py    # 主程序文件
├── vector_util.py        # 向量计算工具模块
├── requirements.txt      # 依赖包列表
└── README.md            # 说明文档
```

## 输出格式

- 生成的法向量图保存为JPEG格式
- 文件命名规则：`原文件名_Nm.jpg`
- 保存位置：`nmPic/` 目录

## 技术细节

### 向量计算

- **叉积计算**：`get_cross_product()` 函数计算两个三维向量的叉积
- **向量归一化**：`vector_normal()` 函数将向量归一化为单位向量
- **模长计算**：`mould()` 函数计算向量的模长

### 界面组件

- **主窗口**：使用QMainWindow构建
- **图片显示**：使用QScrollArea和QLabel显示图片
- **分割器**：使用QSplitter实现左右对比布局
- **文件对话框**：使用QFileDialog选择图片文件

## 系统要求

- Python 3.7+
- PySide6 6.5.0+
- Pillow 9.0.0+
- NumPy 1.21.0+

## 注意事项

1. 输入图片应该是灰度图或彩色图（会自动转换为灰度）
2. 建议使用高对比度的高度图以获得更好的效果
3. 边界像素会被设置为固定的灰色值
4. 生成的法向量图遵循标准的法向量贴图格式（R=X, G=Y, B=Z）

## 许可证

本项目基于原Java版本转换而来，保持相同的功能和使用方式。
